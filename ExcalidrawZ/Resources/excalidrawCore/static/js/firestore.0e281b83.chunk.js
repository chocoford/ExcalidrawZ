/*! For license information please see firestore.0e281b83.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkexcalidraw=self.webpackChunkexcalidraw||[]).push([[1965],{2428:function(t,e,n){n.r(e);var r=n(5637),i=n(9971),o=n(9386),s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},s(t,e)};function a(t){var e="function"===typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var u,c="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},h=h||{},l=c||self;function f(){}function d(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function p(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var y="closure_uid_"+(1e9*Math.random()>>>0),v=0;function m(t,e,n){return t.call.apply(t.bind,arguments)}function g(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function b(t,e,n){return(b=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?m:g).apply(null,arguments)}function w(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function T(){return Date.now()}function I(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Kb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function _(){this.j=this.j,this.i=this.i}_.prototype.j=!1,_.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,y)&&t[y]||(t[y]=++v)})(this)},_.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var E=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"===typeof t)return"string"!==typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},S=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"===typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function A(t){return Array.prototype.concat.apply([],arguments)}function D(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function N(t){return/^[\s\xa0]*$/.test(t)}var C,k=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function R(t,e){return-1!=t.indexOf(e)}function x(t,e){return t<e?-1:t>e?1:0}t:{var O=l.navigator;if(O){var P=O.userAgent;if(P){C=P;break t}}C=""}function L(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function M(t){var e={};for(var n in t)e[n]=t[n];return e}var F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function V(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<F.length;o++)n=F[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function U(t){return U[" "](t),t}U[" "]=f;var q,B=R(C,"Opera"),G=R(C,"Trident")||R(C,"MSIE"),j=R(C,"Edge"),K=j||G,z=R(C,"Gecko")&&!(R(C.toLowerCase(),"webkit")&&!R(C,"Edge"))&&!(R(C,"Trident")||R(C,"MSIE"))&&!R(C,"Edge"),J=R(C.toLowerCase(),"webkit")&&!R(C,"Edge");function Q(){var t=l.document;return t?t.documentMode:void 0}t:{var H="",W=function(){var t=C;return z?/rv:([^\);]+)(\)|;)/.exec(t):j?/Edge\/([\d\.]+)/.exec(t):G?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(t):J?/WebKit\/(\S+)/.exec(t):B?/(?:Version)[ \/]?(\S+)/.exec(t):void 0}();if(W&&(H=W?W[1]:""),G){var Y=Q();if(null!=Y&&Y>parseFloat(H)){q=String(Y);break t}}q=H}var X,Z={};function $(t){return function(t,e){var n=Z;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(){for(var e=0,n=k(String(q)).split("."),r=k(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=x(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||x(0==s[2].length,0==a[2].length)||x(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e}))}if(l.document&&G){var tt=Q();X=tt||(parseInt(q,10)||void 0)}else X=void 0;var et=X,nt=!G||9<=Number(et),rt=G&&!$("9"),it=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",f,e),l.removeEventListener("test",f,e)}catch(n){}return t}();function ot(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function st(t,e){if(ot.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(z){t:{try{U(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"===typeof t.pointerType?t.pointerType:at[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}ot.prototype.b=function(){this.defaultPrevented=!0},I(st,ot);var at={2:"touch",3:"pen",4:"mouse"};st.prototype.b=function(){st.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,rt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var ut="closure_listenable_"+(1e6*Math.random()|0),ct=0;function ht(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++ct,this.Y=this.Z=!1}function lt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function ft(t){this.src=t,this.a={},this.b=0}function dt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=E(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(lt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function pt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}ft.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=pt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new ht(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var yt="closure_lm_"+(1e6*Math.random()|0),vt={};function mt(t,e,n,r,i){if(r&&r.once)return bt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)mt(t,e[o],n,r,i);return null}return n=Dt(n),t&&t[ut]?t.va(e,n,p(r)?!!r.capture:!!r,i):gt(t,e,n,!1,r,i)}function gt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=p(i)?!!i.capture:!!i;if(s&&!nt)return null;var a=St(t);if(a||(t[yt]=a=new ft(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Et,e=nt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)it||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(It(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function bt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)bt(t,e[o],n,r,i);return null}return n=Dt(n),t&&t[ut]?t.wa(e,n,p(r)?!!r.capture:!!r,i):gt(t,e,n,!0,r,i)}function wt(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)wt(t,e[o],n,r,i);else r=p(r)?!!r.capture:!!r,n=Dt(n),t&&t[ut]?(t=t.c,(e=String(e).toString())in t.a&&(-1<(n=pt(o=t.a[e],n,r,i))&&(lt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=St(t))&&(e=t.a[e.toString()],t=-1,e&&(t=pt(e,n,r,i)),(n=-1<t?e[t]:null)&&Tt(n))}function Tt(t){if("number"!==typeof t&&t&&!t.Y){var e=t.src;if(e&&e[ut])dt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(It(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=St(e))?(dt(n,t),0==n.b&&(n.src=null,e[yt]=null)):lt(t)}}}function It(t){return t in vt?vt[t]:vt[t]="on"+t}function _t(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Tt(t),n.call(r,e)}function Et(t,e){if(t.Y)return!0;if(!nt){if(!e)t:{e=["window","event"];for(var n=l,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return _t(t,e=new st(e,this))}return _t(t,new st(e,this))}function St(t){return(t=t[yt])instanceof ft?t:null}var At="__closure_events_fn_"+(1e9*Math.random()>>>0);function Dt(t){return"function"===typeof t?t:(t[At]||(t[At]=function(e){return t.handleEvent(e)}),t[At])}function Nt(){_.call(this),this.c=new ft(this),this.J=this,this.C=null}function Ct(t,e){var n,r=t.C;if(r)for(n=[];r;r=r.C)n.push(r);if(t=t.J,r=e.type||e,"string"===typeof e)e=new ot(e,t);else if(e instanceof ot)e.target=e.target||t;else{var i=e;V(e=new ot(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=kt(s,r,!0,e)&&i}if(i=kt(s=e.a=t,r,!0,e)&&i,i=kt(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=kt(s=e.a=n[o],r,!1,e)&&i}function kt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&dt(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}I(Nt,_),Nt.prototype[ut]=!0,(u=Nt.prototype).addEventListener=function(t,e,n,r){mt(this,t,e,n,r)},u.removeEventListener=function(t,e,n,r){wt(this,t,e,n,r)},u.G=function(){if(Nt.X.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)lt(n[r]);delete e.a[t],e.b--}}this.C=null},u.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},u.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Rt=l.JSON.stringify;function xt(){this.b=this.a=null}var Ot,Pt=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())((function(){return new Mt}),(function(t){t.reset()}));function Lt(){var t=qt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Mt(){this.next=this.b=this.a=null}function Ft(t){l.setTimeout((function(){throw t}),0)}function Vt(t,e){Ot||function(){var t=l.Promise.resolve(void 0);Ot=function(){t.then(Bt)}}(),Ut||(Ot(),Ut=!0),qt.add(t,e)}xt.prototype.add=function(t,e){var n=Pt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Mt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Mt.prototype.reset=function(){this.next=this.b=this.a=null};var Ut=!1,qt=new xt;function Bt(){for(var t;t=Lt();){try{t.a.call(t.b)}catch(n){Ft(n)}var e=Pt;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}Ut=!1}function Gt(t,e){Nt.call(this),this.b=t||1,this.a=e||l,this.f=b(this.Za,this),this.g=T()}function jt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Kt(t,e,n){if("function"===typeof t)n&&(t=b(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=b(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function zt(t){t.a=Kt((function(){t.a=null,t.c&&(t.c=!1,zt(t))}),t.h);var e=t.b;t.b=null,t.g.apply(null,e)}I(Gt,Nt),(u=Gt.prototype).aa=!1,u.M=null,u.Za=function(){if(this.aa){var t=T()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Ct(this,"tick"),this.aa&&(jt(this),this.start()))}},u.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=T())},u.G=function(){Gt.X.G.call(this),jt(this),delete this.a};var Jt=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:zt(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(l.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(_);function Qt(t){_.call(this),this.b=t,this.a={}}I(Qt,_);var Ht=[];function Wt(t,e,n,r){Array.isArray(n)||(n&&(Ht[0]=n.toString()),n=Ht);for(var i=0;i<n.length;i++){var o=mt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function Yt(t){L(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Tt(t)}),t),t.a={}}function Xt(){this.a=!0}function Zt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Rt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")}))}Qt.prototype.G=function(){Qt.X.G.call(this),Yt(this)},Qt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Xt.prototype.info=function(){};var $t={},te=null;function ee(){return te=te||new Nt}function ne(t){ot.call(this,$t.Fa,t)}function re(t){var e=ee();Ct(e,new ne(e,t))}function ie(t,e){ot.call(this,$t.STAT_EVENT,t),this.stat=e}function oe(t){var e=ee();Ct(e,new ie(e,t))}function se(t){ot.call(this,$t.Ga,t)}function ae(t,e){if("function"!==typeof t)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){t()}),e)}$t.Fa="serverreachability",I(ne,ot),$t.STAT_EVENT="statevent",I(ie,ot),$t.Ga="timingevent",I(se,ot);var ue={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},ce={fb:"complete",Bb:"success",Ea:"error",Da:"abort",tb:"ready",ub:"readystatechange",TIMEOUT:"timeout",pb:"incrementaldata",sb:"progress",ib:"downloadprogress",Jb:"uploadprogress"};function he(){}function le(t){var e;return(e=t.a)||(e=t.a={}),e}function fe(){}he.prototype.a=null;var de,pe={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function ye(){ot.call(this,"d")}function ve(){ot.call(this,"c")}function me(){}function ge(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new Qt(this),this.P=be,t=K?125:void 0,this.R=new Gt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}I(ye,ot),I(ve,ot),I(me,he),de=new me;var be=45e3,we={},Te={};function Ie(t,e,n){t.H=1,t.i=Ke(Ve(e)),t.j=n,t.I=!0,_e(t,null)}function _e(t,e){t.u=T(),Ae(t),t.l=Ve(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),rn(n.b,"t",r),t.D=0,t.a=Zn(t.g,t.g.C?e:null),0<t.O&&(t.F=new Jt(b(t.Ca,t,t.a),t.O)),Wt(t.J,t.a,"readystatechange",t.Xa),e=t.B?M(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),re(1),function(t,e,n,r,i,o){t.info((function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s}))}(t.c,t.m,t.l,t.f,t.S,t.j)}function Ee(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Se(t,n);if(i==Te){4==e&&(t.h=4,oe(14),r=!1),Zt(t.c,t.f,null,"[Incomplete Response]");break}if(i==we){t.h=4,oe(15),Zt(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}Zt(t.c,t.f,i,null),Re(t,i)}4==e&&0==n.length&&(t.h=1,oe(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Kn(e),e.F=!0,oe(11))):(Zt(t.c,t.f,n,"[Invalid Chunked Response]"),ke(t),Ce(t))}function Se(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Te:(n=Number(e.substring(n,r)),isNaN(n)?we:(r+=1)+n>e.length?Te:(e=e.substr(r,n),t.D=r+n,e))}function Ae(t){t.T=T()+t.P,De(t,t.P)}function De(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=ae(b(t.Va,t),e)}function Ne(t){t.o&&(l.clearTimeout(t.o),t.o=null)}function Ce(t){0==t.g.v||t.A||Qn(t.g,t)}function ke(t){Ne(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,jt(t.R),Yt(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Re(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||ln(n.b,t)))if(n.I=t.N,!t.C&&ln(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(qf){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Jn(n),Ln(n)}jn(n),oe(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=ae(b(n.Sa,n),6e3));if(1>=hn(n.b)&&n.ea){try{n.ea()}catch(qf){}n.ea=void 0}}else Wn(n,11)}else if((t.C||n.a==t)&&Jn(n),!N(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var o=i[3];null!=o&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];null!=s&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"===typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(R(h,"spdy")||R(h,"quic")||R(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(fn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,je(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=T()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=Xn(u,u.C?u.ga:null,u.fa),d.C){dn(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(Ne(p),Ae(p)),u.a=d}else Gn(u);0<n.g.length&&Vn(n)}else"stop"!=i[0]&&"close"!=i[0]||Wn(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?Wn(n,7):Pn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);re(4)}catch(qf){}}function xe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||"string"===typeof t)S(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(d(t)||"string"===typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"===typeof t)return t.split("");if(d(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Oe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Oe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Pe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Le(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Le(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Le(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(u=ge.prototype).setTimeout=function(t){this.P=t},u.Xa=function(t){t=t.target;var e=this.F;e&&3==kn(t)?e.f():this.Ca(t)},u.Ca=function(t){try{if(t==this.a)t:{var e=kn(this.a),n=this.a.ua(),r=this.a.W();if(!(3>e||3==e&&!K&&!this.a.$())){this.A||4!=e||7==n||re(8==n||0>=r?3:2),Ne(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s}))}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!N(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,oe(12),ke(this),Ce(this);break t}Zt(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Re(this,u)}this.I?(Ee(this,e,o),K&&this.b&&3==e&&(Wt(this.J,this.R,"tick",this.Wa),this.R.start())):(Zt(this.c,this.f,o,null),Re(this,o)),4==e&&ke(this),this.b&&!this.A&&(4==e?Qn(this.g,this):(this.b=!1,Ae(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,oe(12)):(this.h=0,oe(13)),ke(this),Ce(this)}}}catch(c){}},u.Wa=function(){if(this.a){var t=kn(this.a),e=this.a.$();this.D<e.length&&(Ne(this),Ee(this,t,e),this.b&&4!=t&&Ae(this))}},u.cancel=function(){this.A=!0,ke(this)},u.Va=function(){this.o=null;var t=T();0<=t-this.T?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.c,this.l),2!=this.H&&(re(3),oe(17)),ke(this),this.h=2,Ce(this)):De(this,this.T-t)},(u=Oe.prototype).K=function(){Pe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},u.L=function(){return Pe(this),this.a.concat()},u.get=function(t,e){return Le(this.b,t)?this.b[t]:e},u.set=function(t,e){Le(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},u.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Me=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Fe(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Fe){this.a=void 0!==e?e:t.a,Ue(this,t.f),this.j=t.j,qe(this,t.c),Be(this,t.h),this.g=t.g,e=t.b;var n=new $e;n.c=e.c,e.a&&(n.a=new Oe(e.a),n.b=e.b),Ge(this,n),this.i=t.i}else t&&(n=String(t).match(Me))?(this.a=!!e,Ue(this,n[1]||"",!0),this.j=ze(n[2]||""),qe(this,n[3]||"",!0),Be(this,n[4]),this.g=ze(n[5]||"",!0),Ge(this,n[6]||"",!0),this.i=ze(n[7]||"")):(this.a=!!e,this.b=new $e(null,this.a))}function Ve(t){return new Fe(t)}function Ue(t,e,n){t.f=n?ze(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function qe(t,e,n){t.c=n?ze(e,!0):e}function Be(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ge(t,e,n){e instanceof $e?(t.b=e,function(t,e){e&&!t.f&&(tn(t),t.c=null,t.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(en(this,e),rn(this,n,t))}),t)),t.f=e}(t.b,t.a)):(n||(e=Je(e,Xe)),t.b=new $e(e,t.a))}function je(t,e,n){t.b.set(e,n)}function Ke(t){return je(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^T()).toString(36)),t}function ze(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Je(t,e,n){return"string"===typeof t?(t=encodeURI(t).replace(e,Qe),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Qe(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Fe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Je(e,He,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Je(e,He,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Je(n,"/"==n.charAt(0)?Ye:We,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Je(n,Ze)),t.join("")};var He=/[#\/\?@]/g,We=/[#\?:]/g,Ye=/[#\?]/g,Xe=/[#\?@]/g,Ze=/#/g;function $e(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function tn(t){t.a||(t.a=new Oe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function en(t,e){tn(t),e=on(t,e),Le(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Le((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Pe(t)))}function nn(t,e){return tn(t),e=on(t,e),Le(t.a.b,e)}function rn(t,e,n){en(t,e),0<n.length&&(t.c=null,t.a.set(on(t,e),D(n)),t.b+=n.length)}function on(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(u=$e.prototype).add=function(t,e){tn(this),this.c=null,t=on(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},u.forEach=function(t,e){tn(this),this.a.forEach((function(n,r){S(n,(function(n){t.call(e,n,r,this)}),this)}),this)},u.L=function(){tn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},u.K=function(t){tn(this);var e=[];if("string"===typeof t)nn(this,t)&&(e=A(e,this.a.get(on(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=A(e,t[n])}return e},u.set=function(t,e){return tn(this),this.c=null,nn(this,t=on(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},u.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},u.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var sn=function(t,e){this.b=t,this.a=e};function an(t){this.g=t||un,l.PerformanceNavigationTiming?t=0<(t=l.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(l.ia&&l.ia.ya&&l.ia.ya()&&l.ia.ya().Lb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var un=10;function cn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function hn(t){return t.b?1:t.a?t.a.size:0}function ln(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function fn(t,e){t.a?t.a.add(e):t.b=e}function dn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function pn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=a(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(u){e={error:u}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return D(t.c)}function yn(){}function vn(){this.a=new yn}function mn(t,e,n){var r=n||"";try{xe(t,(function(t,n){var i=t;p(t)&&(i=Rt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(_d){throw e.push(r+"type="+encodeURIComponent("_badmap")),_d}}function gn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}an.prototype.cancel=function(){var t,e;if(this.c=pn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=a(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},yn.prototype.stringify=function(t){return l.JSON.stringify(t,void 0)},yn.prototype.parse=function(t){return l.JSON.parse(t,void 0)};var bn=l.JSON.parse;function wn(t){Nt.call(this),this.headers=new Oe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Tn,this.D=this.F=!1}I(wn,Nt);var Tn="",In=/^https?$/i,_n=["POST","PUT"];function En(t){return"content-type"==t.toLowerCase()}function Sn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,An(t),Nn(t)}function An(t){t.u||(t.u=!0,Ct(t,"complete"),Ct(t,"error"))}function Dn(t){if(t.b&&"undefined"!=typeof h&&(!t.s[1]||4!=kn(t)||2!=t.W()))if(t.l&&4==kn(t))Kt(t.za,0,t);else if(Ct(t,"readystatechange"),4==kn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.B).match(Me)[1]||null;if(!o&&l.self&&l.self.location){var s=l.self.location.protocol;o=s.substr(0,s.length-1)}i=!In.test(o?o.toLowerCase():"")}e=i}if(e)Ct(t,"complete"),Ct(t,"success");else{t.h=6;try{var a=2<kn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",An(t)}}finally{Nn(t)}}}function Nn(t,e){if(t.a){Cn(t);var n=t.a,r=t.s[0]?f:null;t.a=null,t.s=null,e||Ct(t,"ready");try{n.onreadystatechange=r}catch(_d){}}}function Cn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(l.clearTimeout(t.m),t.m=null)}function kn(t){return t.a?t.a.readyState:0}function Rn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return L(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"===typeof t?null!=n&&encodeURIComponent(String(n)):je(t,e,n))}function xn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function On(t){this.pa=0,this.g=[],this.c=new Xt,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=xn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=xn("baseRetryDelayMs",5e3,t),this.Ra=xn("retryDelaySeedMs",1e4,t),this.Ma=xn("forwardChannelMaxRetries",2,t),this.ma=xn("forwardChannelRequestTimeoutMs",2e4,t),this.Na=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new an(t&&t.concurrentRequestLimit),this.ka=new vn,this.da=t&&t.fastHandshake||!1,this.Ia=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&t&&t.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Pn(t){if(Mn(t),3==t.v){var e=t.R++,n=Ve(t.B);je(n,"SID",t.J),je(n,"RID",e),je(n,"TYPE","terminate"),qn(t,n),(e=new ge(t,t.c,e,void 0)).H=2,e.i=Ke(Ve(n)),n=!1,l.navigator&&l.navigator.sendBeacon&&(n=l.navigator.sendBeacon(e.i.toString(),"")),!n&&l.Image&&((new Image).src=e.i,n=!0),n||(e.a=Zn(e.g,null),e.a.ba(e.i)),e.u=T(),Ae(e)}Yn(t)}function Ln(t){t.a&&(Kn(t),t.a.cancel(),t.a=null)}function Mn(t){Ln(t),t.j&&(l.clearTimeout(t.j),t.j=null),Jn(t),t.b.cancel(),t.h&&("number"===typeof t.h&&l.clearTimeout(t.h),t.h=null)}function Fn(t,e){t.g.push(new sn(t.Oa++,e)),3==t.v&&Vn(t)}function Vn(t){cn(t.b)||t.h||(t.h=!0,Vt(t.Ba,t),t.u=0)}function Un(t,e){var n;n=e?e.f:t.R++;var r=Ve(t.B);je(r,"SID",t.J),je(r,"RID",n),je(r,"AID",t.P),qn(t,r),t.i&&t.l&&Rn(r,t.i,t.l),n=new ge(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Bn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),fn(t.b,n),Ie(n,r,e)}function qn(t,e){t.f&&xe({},(function(t,n){je(e,n,t)}))}function Bn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?b(t.f.Ja,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{mn(h,s,"req"+c+"_")}catch(Or){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Gn(t){t.a||t.j||(t.T=1,Vt(t.Aa,t),t.o=0)}function jn(t){return!(t.a||t.j||3<=t.o)&&(t.T++,t.j=ae(b(t.Aa,t),Hn(t,t.o)),t.o++,!0)}function Kn(t){null!=t.s&&(l.clearTimeout(t.s),t.s=null)}function zn(t){t.a=new ge(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=Ve(t.la);je(e,"RID","rpc"),je(e,"SID",t.J),je(e,"CI",t.H?"0":"1"),je(e,"AID",t.P),qn(t,e),je(e,"TYPE","xmlhttp"),t.i&&t.l&&Rn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Ke(Ve(e)),n.j=null,n.I=!0,_e(n,t)}function Jn(t){null!=t.m&&(l.clearTimeout(t.m),t.m=null)}function Qn(t,e){var n=null;if(t.a==e){Jn(t),Kn(t),t.a=null;var r=2}else{if(!ln(t.b,e))return;n=e.s,dn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=T()-e.u;var i=t.u;Ct(r=ee(),new se(r,n,e,i)),Vn(t)}else Gn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(hn(t.b)>=t.b.f-(t.h?1:0))&&(t.h?(t.g=e.s.concat(t.g),!0):!(1==t.v||2==t.v||t.u>=(t.La?0:t.Ma))&&(t.h=ae(b(t.Ba,t,e),Hn(t,t.u)),t.u++,!0))}(t,e)||2==r&&jn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:Wn(t,5);break;case 4:Wn(t,10);break;case 3:Wn(t,6);break;default:Wn(t,2)}}function Hn(t,e){var n=t.Ha+Math.floor(Math.random()*t.Ra);return t.f||(n*=2),n*e}function Wn(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=b(t.Ya,t);n||(n=new Fe("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Ue(n,"https"),Ke(n)),function(t,e){var n=new Xt;if(l.Image){var r=new Image;r.onload=w(gn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=w(gn,n,r,"TestLoadImage: error",!1,e),r.onabort=w(gn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=w(gn,n,r,"TestLoadImage: timeout",!1,e),l.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else oe(2);t.v=0,t.f&&t.f.ra(e),Yn(t),Mn(t)}function Yn(t){t.v=0,t.I=-1,t.f&&(0==pn(t.b).length&&0==t.g.length||(t.b.c.length=0,D(t.g),t.g.length=0),t.f.qa())}function Xn(t,e,n){var r=function(t){return t instanceof Fe?Ve(t):new Fe(t,void 0)}(n);if(""!=r.c)e&&qe(r,e+"."+r.c),Be(r,r.h);else{var i=l.location;r=function(t,e,n,r){var i=new Fe(null,void 0);return t&&Ue(i,t),e&&qe(i,e),n&&Be(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&L(t.V,(function(t,e){je(r,e,t)})),e=t.A,n=t.na,e&&n&&je(r,e,n),je(r,"VER",t.ha),qn(t,r),r}function Zn(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new wn(t.Na)).F=t.C,e}function $n(){}function tr(){if(G&&!(10<=Number(et)))throw Error("Environmental error: no available transport.")}function er(t,e){Nt.call(this),this.a=new On(e),this.o=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!N(t)&&(this.a.i=t),this.m=e&&e.supportsCrossDomainXhr||!1,this.l=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!N(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new ir(this)}function nr(t){ye.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function rr(){ve.call(this),this.status=1}function ir(t){this.a=t}(u=wn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?le(this.H):le(de),this.a.onreadystatechange=b(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(o){return void Sn(this,o)}t=n||"";var i=new Oe(this.headers);r&&xe(r,(function(t,e){i.set(e,t)})),r=function(t){t:{for(var e=En,n=t.length,r="string"===typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"===typeof t?t.charAt(e):t[e]}(i.L()),n=l.FormData&&t instanceof l.FormData,!(0<=E(_n,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Cn(this),0<this.o&&((this.D=function(t){return G&&$(9)&&"number"===typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=b(this.xa,this)):this.m=Kt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(o){Sn(this,o)}},u.xa=function(){"undefined"!=typeof h&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,Ct(this,"timeout"),this.abort(8))},u.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Ct(this,"complete"),Ct(this,"abort"),Nn(this))},u.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Nn(this,!0)),wn.X.G.call(this)},u.za=function(){this.j||(this.A||this.l||this.g?Dn(this):this.Ua())},u.Ua=function(){Dn(this)},u.W=function(){try{return 2<kn(this)?this.a.status:-1}catch(t){return-1}},u.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},u.Pa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),bn(e)}},u.ua=function(){return this.h},u.Qa=function(){return"string"===typeof this.f?this.f:String(this.f)},(u=On.prototype).ha=8,u.v=1,u.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new ge(this,this.c,t,void 0),r=this.l;if(this.O&&(r?V(r=M(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"===typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Bn(this,n,e),je(i=Ve(this.B),"RID",t),je(i,"CVER",22),this.A&&je(i,"X-HTTP-Session-Id",this.A),qn(this,i),this.i&&r&&Rn(i,this.i,r),fn(this.b,n),this.Ia&&je(i,"TYPE","init"),this.da?(je(i,"$req",e),je(i,"SID","null"),n.U=!0,Ie(n,i,null)):Ie(n,i,e),this.v=2}}else 3==this.v&&(t?Un(this,t):0==this.g.length||cn(this.b)||Un(this))},u.Aa=function(){if(this.j=null,zn(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=ae(b(this.Ta,this),t)}},u.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,oe(10),Ln(this),zn(this))},u.Sa=function(){null!=this.m&&(this.m=null,Ln(this),jn(this),oe(19))},u.Ya=function(t){t?(this.c.info("Successfully pinged google.com"),oe(2)):(this.c.info("Failed to ping google.com"),oe(1))},(u=$n.prototype).ta=function(){},u.sa=function(){},u.ra=function(){},u.qa=function(){},u.Ja=function(){},tr.prototype.a=function(t,e){return new er(t,e)},I(er,Nt),er.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var t=this.a,e=this.o,n=this.b||void 0;oe(0),t.fa=e,t.V=n||{},t.H=t.S,t.B=Xn(t,null,t.fa),Vn(t)},er.prototype.close=function(){Pn(this.a)},er.prototype.h=function(t){if("string"===typeof t){var e={};e.__data__=t,Fn(this.a,e)}else this.l?((e={}).__data__=Rt(t),Fn(this.a,e)):Fn(this.a,t)},er.prototype.G=function(){this.a.f=null,delete this.f,Pn(this.a),delete this.a,er.X.G.call(this)},I(nr,ye),I(rr,ve),I(ir,$n),ir.prototype.ta=function(){Ct(this.a,"a")},ir.prototype.sa=function(t){Ct(this.a,new nr(t))},ir.prototype.ra=function(t){Ct(this.a,new rr(t))},ir.prototype.qa=function(){Ct(this.a,"b")},tr.prototype.createWebChannel=tr.prototype.a,er.prototype.send=er.prototype.h,er.prototype.open=er.prototype.g,er.prototype.close=er.prototype.close,ue.NO_ERROR=0,ue.TIMEOUT=8,ue.HTTP_ERROR=6,ce.COMPLETE="complete",fe.EventType=pe,pe.OPEN="a",pe.CLOSE="b",pe.ERROR="c",pe.MESSAGE="d",Nt.prototype.listen=Nt.prototype.va,wn.prototype.listenOnce=wn.prototype.wa,wn.prototype.getLastError=wn.prototype.Qa,wn.prototype.getLastErrorCode=wn.prototype.ua,wn.prototype.getStatus=wn.prototype.W,wn.prototype.getResponseJson=wn.prototype.Pa,wn.prototype.getResponseText=wn.prototype.$,wn.prototype.send=wn.prototype.ba;var or=function(){return new tr},sr=function(){return ee()},ar=ue,ur=ce,cr=$t,hr={gb:0,jb:1,kb:2,Db:3,Ib:4,Fb:5,Gb:6,Eb:7,Cb:8,Hb:9,PROXY:10,NOPROXY:11,Ab:12,wb:13,xb:14,vb:15,yb:16,zb:17,bb:18,ab:19,cb:20},lr=fe,fr=wn,dr=n(9388),pr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();pr.o=-1;var yr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},vr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return(0,dr.ZT)(e,t),e}(Error),mr=new o.Yd("@firebase/firestore");function gr(){return mr.logLevel}function br(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(mr.logLevel<=o.in.DEBUG){var r=e.map(Ir);mr.debug.apply(mr,(0,dr.ev)(["Firestore (8.3.3): "+t],r))}}function wr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(mr.logLevel<=o.in.ERROR){var r=e.map(Ir);mr.error.apply(mr,(0,dr.ev)(["Firestore (8.3.3): "+t],r))}}function Tr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(mr.logLevel<=o.in.WARN){var r=e.map(Ir);mr.warn.apply(mr,(0,dr.ev)(["Firestore (8.3.3): "+t],r))}}function Ir(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function _r(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.3.3) INTERNAL ASSERTION FAILED: "+t;throw wr(e),new Error(e)}function Er(t,e){t||_r()}function Sr(t,e){return t}function Ar(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Dr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Ar(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Nr(t,e){return t<e?-1:t>e?1:0}function Cr(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function kr(t){return t+"\0"}var Rr=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new vr(yr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new vr(yr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new vr(yr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new vr(yr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Nr(this.nanoseconds,t.nanoseconds):Nr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),xr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new Rr(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Or(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Pr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Lr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Mr=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&_r(),void 0===n?n=t.length-e:n>t.length-e&&_r(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),Fr=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,dr.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new vr(yr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter((function(t){return t.length>0})))}return new e(r)},e.emptyPath=function(){return new e([])},e}(Mr),Vr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ur=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,dr.ZT)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return Vr.test(t)},e.prototype.canonicalString=function(){return this.toArray().map((function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t})).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new vr(yr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new vr(yr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new vr(yr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new vr(yr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(Mr),qr=function(){function t(t){this.fields=t,t.sort(Ur.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Cr(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),Br=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Nr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();Br.EMPTY_BYTE_STRING=new Br("");var Gr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function jr(t){if(Er(!!t),"string"==typeof t){var e=0,n=Gr.exec(t);if(Er(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Kr(t.seconds),nanos:Kr(t.nanos)}}function Kr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function zr(t){return"string"==typeof t?Br.fromBase64String(t):Br.fromUint8Array(t)}function Jr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Qr(t){var e=t.mapValue.fields.__previous_value__;return Jr(e)?Qr(e):e}function Hr(t){var e=jr(t.mapValue.fields.__local_write_time__.timestampValue);return new Rr(e.seconds,e.nanos)}function Wr(t){return null==t}function Yr(t){return 0===t&&1/t==-1/0}function Xr(t){return"number"==typeof t&&Number.isInteger(t)&&!Yr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Zr=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(Fr.fromString(e))},t.fromName=function(e){return new t(Fr.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===Fr.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return Fr.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new Fr(e.slice()))},t}();function $r(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Jr(t)?4:10:_r()}function ti(t,e){var n=$r(t);if(n!==$r(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Hr(t).isEqual(Hr(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=jr(t.timestampValue),r=jr(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return zr(t.bytesValue).isEqual(zr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Kr(t.geoPointValue.latitude)===Kr(e.geoPointValue.latitude)&&Kr(t.geoPointValue.longitude)===Kr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Kr(t.integerValue)===Kr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Kr(t.doubleValue),r=Kr(e.doubleValue);return n===r?Yr(n)===Yr(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Cr(t.arrayValue.values||[],e.arrayValue.values||[],ti);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Or(n)!==Or(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ti(n[i],r[i])))return!1;return!0}(t,e);default:return _r()}}function ei(t,e){return void 0!==(t.values||[]).find((function(t){return ti(t,e)}))}function ni(t,e){var n=$r(t),r=$r(e);if(n!==r)return Nr(n,r);switch(n){case 0:return 0;case 1:return Nr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=Kr(t.integerValue||t.doubleValue),r=Kr(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return ri(t.timestampValue,e.timestampValue);case 4:return ri(Hr(t),Hr(e));case 5:return Nr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=zr(t),r=zr(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Nr(n[i],r[i]);if(0!==o)return o}return Nr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Nr(Kr(t.latitude),Kr(e.latitude));return 0!==n?n:Nr(Kr(t.longitude),Kr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=ni(n[i],r[i]);if(o)return o}return Nr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Nr(r[s],o[s]);if(0!==a)return a;var u=ni(n[r[s]],i[o[s]]);if(0!==u)return u}return Nr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw _r()}}function ri(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Nr(t,e);var n=jr(t),r=jr(e),i=Nr(n.seconds,r.seconds);return 0!==i?i:Nr(n.nanos,r.nanos)}function ii(t){return oi(t)}function oi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=jr(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?zr(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,Zr.fromName(n).toString()):"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=oi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+oi(t.fields[o])}return e+"}"}(t.mapValue):_r();var e,n}function si(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function ai(t){return!!t&&"integerValue"in t}function ui(t){return!!t&&"arrayValue"in t}function ci(t){return!!t&&"nullValue"in t}function hi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function li(t){return!!t&&"mapValue"in t}var fi=function(){function t(t){this.overlayMap=new Map,this.partialValue=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(e){return t.extractNestedValue(this.buildProto(),e)},t.prototype.toProto=function(){return this.field(Ur.emptyPath())},t.prototype.set=function(t,e){this.setOverlay(t,e)},t.prototype.setAll=function(t){var e=this;t.forEach((function(t,n){t?e.set(n,t):e.delete(n)}))},t.prototype.delete=function(t){this.setOverlay(t,null)},t.prototype.isEqual=function(t){return ti(this.buildProto(),t.buildProto())},t.prototype.setOverlay=function(t,e){for(var n=this.overlayMap,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===$r(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t.lastSegment(),e)},t.prototype.applyOverlay=function(e,n){var r=this,i=!1,o=t.extractNestedValue(this.partialValue,e),s=li(o)?Object.assign({},o.mapValue.fields):{};return n.forEach((function(t,n){if(t instanceof Map){var o=r.applyOverlay(e.child(n),t);null!=o&&(s[n]=o,i=!0)}else null!==t?(s[n]=t,i=!0):s.hasOwnProperty(n)&&(delete s[n],i=!0)})),i?{mapValue:{fields:s}}:null},t.prototype.buildProto=function(){var t=this.applyOverlay(Ur.emptyPath(),this.overlayMap);return null!=t&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},t.extractNestedValue=function(t,e){if(e.isEmpty())return t;for(var n=t,r=0;r<e.length-1;++r){if(!n.mapValue.fields)return null;if(!li(n=n.mapValue.fields[e.get(r)]))return null}return(n=(n.mapValue.fields||{})[e.lastSegment()])||null},t.prototype.clone=function(){return new t(this.buildProto())},t}();function di(t){var e=[];return Pr(t.fields||{},(function(t,n){var r=new Ur([t]);if(li(n)){var i=di(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var a=s[o];e.push(r.child(a))}}else e.push(r)})),new qr(e)}var pi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,xr.min(),fi.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,fi.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,fi.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=fi.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=fi.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),yi=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function vi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new yi(t,e,n,r,i,o,s)}function mi(t){var e=Sr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((function(t){return function(t){return t.field.canonicalString()+t.op.toString()+ii(t.value)}(t)})).join(","),n+="|ob:",n+=e.orderBy.map((function(t){return function(t){return t.field.canonicalString()+t.dir}(t)})).join(","),Wr(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=ki(e.startAt)),e.endAt&&(n+="|ub:",n+=ki(e.endAt)),e.h=n}return e.h}function gi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!xi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!ti(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Pi(t.startAt,e.startAt)&&Pi(t.endAt,e.endAt)}function bi(t){return Zr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var wi=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return(0,dr.ZT)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Ti(t,n,r):"array-contains"===n?new Si(t,r):"in"===n?new Ai(t,r):"not-in"===n?new Di(t,r):"array-contains-any"===n?new Ni(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Ii(t,n):new _i(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(ni(e,this.value)):null!==e&&$r(this.value)===$r(e)&&this.m(ni(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return _r()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}((function(){})),Ti=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Zr.fromName(r.referenceValue),i}return(0,dr.ZT)(e,t),e.prototype.matches=function(t){var e=Zr.comparator(t.key,this.key);return this.m(e)},e}(wi),Ii=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Ei("in",n),r}return(0,dr.ZT)(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(wi),_i=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Ei("not-in",n),r}return(0,dr.ZT)(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(wi);function Ei(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return Zr.fromName(t.referenceValue)}))}var Si=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return(0,dr.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return ui(e)&&ei(e.arrayValue,this.value)},e}(wi),Ai=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return(0,dr.ZT)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&ei(this.value.arrayValue,e)},e}(wi),Di=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return(0,dr.ZT)(e,t),e.prototype.matches=function(t){if(ei(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!ei(this.value.arrayValue,e)},e}(wi),Ni=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return(0,dr.ZT)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!ui(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return ei(e.value.arrayValue,t)}))},e}(wi),Ci=function(t,e){this.position=t,this.before=e};function ki(t){return(t.before?"b":"a")+":"+t.position.map((function(t){return ii(t)})).join(",")}var Ri=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function xi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Oi(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Zr.comparator(Zr.fromName(s.referenceValue),n.key):ni(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Pi(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ti(t.position[n],e.position[n]))return!1;return!0}var Li=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function Mi(t,e,n,r,i,o,s,a){return new Li(t,e,n,r,i,o,s,a)}function Fi(t){return new Li(t)}function Vi(t){return!Wr(t.limit)&&"F"===t.limitType}function Ui(t){return!Wr(t.limit)&&"L"===t.limitType}function qi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function Bi(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function Gi(t){return null!==t.collectionGroup}function ji(t){var e=Sr(t);if(null===e.p){e.p=[];var n=Bi(e),r=qi(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Ri(n)),e.p.push(new Ri(Ur.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Ri(Ur.keyField(),u))}}}return e.p}function Ki(t){var e=Sr(t);if(!e.T)if("F"===e.limitType)e.T=vi(e.path,e.collectionGroup,ji(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=ji(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new Ri(o.field,s))}var a=e.endAt?new Ci(e.endAt.position,!e.endAt.before):null,u=e.startAt?new Ci(e.startAt.position,!e.startAt.before):null;e.T=vi(e.path,e.collectionGroup,n,e.filters,e.limit,a,u)}return e.T}function zi(t,e,n){return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Ji(t,e){return gi(Ki(t),Ki(e))&&t.limitType===e.limitType}function Qi(t){return mi(Ki(t))+"|lt:"+t.limitType}function Hi(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map((function(t){return(e=t).field.canonicalString()+" "+e.op+" "+ii(e.value);var e})).join(", ")+"]"),Wr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map((function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)})).join(", ")+"]"),t.startAt&&(e+=", startAt: "+ki(t.startAt)),t.endAt&&(e+=", endAt: "+ki(t.endAt)),"Target("+e+")"}(Ki(t))+"; limitType="+t.limitType+")"}function Wi(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Zr.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Oi(t.startAt,ji(t),e))&&(!t.endAt||!Oi(t.endAt,ji(t),e))}(t,e)}function Yi(t){return function(e,n){for(var r=!1,i=0,o=ji(t);i<o.length;i++){var s=o[i],a=Xi(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function Xi(t,e,n){var r=t.field.isKeyField()?Zr.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?ni(r,i):_r()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return _r()}}function Zi(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Yr(e)?"-0":e}}function $i(t){return{integerValue:""+t}}function to(t,e){return Xr(e)?$i(e):Zi(t,e)}var eo=function(){this._=void 0};function no(t,e,n){return t instanceof oo?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof so?ao(t,e):t instanceof uo?co(t,e):function(t,e){var n=io(t,e),r=lo(n)+lo(t.A);return ai(n)&&ai(t.A)?$i(r):Zi(t.R,r)}(t,e)}function ro(t,e,n){return t instanceof so?ao(t,e):t instanceof uo?co(t,e):n}function io(t,e){return t instanceof ho?ai(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var oo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,dr.ZT)(e,t),e}(eo),so=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,dr.ZT)(e,t),e}(eo);function ao(t,e){for(var n=fo(e),r=function(t){n.some((function(e){return ti(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var uo=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return(0,dr.ZT)(e,t),e}(eo);function co(t,e){for(var n=fo(e),r=function(t){n=n.filter((function(e){return!ti(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ho=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return(0,dr.ZT)(e,t),e}(eo);function lo(t){return Kr(t.integerValue||t.doubleValue)}function fo(t){return ui(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var po=function(t,e){this.field=t,this.transform=e},yo=function(t,e){this.version=t,this.transformResults=e},vo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function mo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var go=function(){};function bo(t,e,n){t instanceof Eo?function(t,e,n){var r=t.value.clone(),i=Do(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof So?function(t,e,n){if(mo(t.precondition,e)){var r=Do(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Ao(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function wo(t,e,n){t instanceof Eo?function(t,e,n){if(mo(t.precondition,e)){var r=t.value.clone(),i=No(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(_o(e),r).setHasLocalMutations()}}(t,e,n):t instanceof So?function(t,e,n){if(mo(t.precondition,e)){var r=No(t.fieldTransforms,n,e),i=e.data;i.setAll(Ao(t)),i.setAll(r),e.convertToFoundDocument(_o(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){mo(t.precondition,e)&&e.convertToNoDocument(xr.min())}(t,e)}function To(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=io(o.transform,s||null);null!=a&&(null==n&&(n=fi.empty()),n.set(o.field,a))}return n||null}function Io(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Cr(t,e,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof so&&e instanceof so||t instanceof uo&&e instanceof uo?Cr(t.elements,e.elements,ti):t instanceof ho&&e instanceof ho?ti(t.A,e.A):t instanceof oo&&e instanceof oo}(t.transform,e.transform)}(t,e)}))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function _o(t){return t.isFoundDocument()?t.version:xr.min()}var Eo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return(0,dr.ZT)(e,t),e}(go),So=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return(0,dr.ZT)(e,t),e}(go);function Ao(t){var e=new Map;return t.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}})),e}function Do(t,e,n){var r=new Map;Er(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,ro(s,a,n[i]))}return r}function No(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,no(a,u,e))}return r}var Co,ko,Ro=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return(0,dr.ZT)(e,t),e}(go),xo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return(0,dr.ZT)(e,t),e}(go),Oo=function(t){this.count=t};function Po(t){switch(t){case yr.OK:return _r();case yr.CANCELLED:case yr.UNKNOWN:case yr.DEADLINE_EXCEEDED:case yr.RESOURCE_EXHAUSTED:case yr.INTERNAL:case yr.UNAVAILABLE:case yr.UNAUTHENTICATED:return!1;case yr.INVALID_ARGUMENT:case yr.NOT_FOUND:case yr.ALREADY_EXISTS:case yr.PERMISSION_DENIED:case yr.FAILED_PRECONDITION:case yr.ABORTED:case yr.OUT_OF_RANGE:case yr.UNIMPLEMENTED:case yr.DATA_LOSS:return!0;default:return _r()}}function Lo(t){if(void 0===t)return wr("GRPC error has no .code"),yr.UNKNOWN;switch(t){case Co.OK:return yr.OK;case Co.CANCELLED:return yr.CANCELLED;case Co.UNKNOWN:return yr.UNKNOWN;case Co.DEADLINE_EXCEEDED:return yr.DEADLINE_EXCEEDED;case Co.RESOURCE_EXHAUSTED:return yr.RESOURCE_EXHAUSTED;case Co.INTERNAL:return yr.INTERNAL;case Co.UNAVAILABLE:return yr.UNAVAILABLE;case Co.UNAUTHENTICATED:return yr.UNAUTHENTICATED;case Co.INVALID_ARGUMENT:return yr.INVALID_ARGUMENT;case Co.NOT_FOUND:return yr.NOT_FOUND;case Co.ALREADY_EXISTS:return yr.ALREADY_EXISTS;case Co.PERMISSION_DENIED:return yr.PERMISSION_DENIED;case Co.FAILED_PRECONDITION:return yr.FAILED_PRECONDITION;case Co.ABORTED:return yr.ABORTED;case Co.OUT_OF_RANGE:return yr.OUT_OF_RANGE;case Co.UNIMPLEMENTED:return yr.UNIMPLEMENTED;case Co.DATA_LOSS:return yr.DATA_LOSS;default:return _r()}}(ko=Co||(Co={}))[ko.OK=0]="OK",ko[ko.CANCELLED=1]="CANCELLED",ko[ko.UNKNOWN=2]="UNKNOWN",ko[ko.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ko[ko.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ko[ko.NOT_FOUND=5]="NOT_FOUND",ko[ko.ALREADY_EXISTS=6]="ALREADY_EXISTS",ko[ko.PERMISSION_DENIED=7]="PERMISSION_DENIED",ko[ko.UNAUTHENTICATED=16]="UNAUTHENTICATED",ko[ko.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ko[ko.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ko[ko.ABORTED=10]="ABORTED",ko[ko.OUT_OF_RANGE=11]="OUT_OF_RANGE",ko[ko.UNIMPLEMENTED=12]="UNIMPLEMENTED",ko[ko.INTERNAL=13]="INTERNAL",ko[ko.UNAVAILABLE=14]="UNAVAILABLE",ko[ko.DATA_LOSS=15]="DATA_LOSS";var Mo=function(){function t(t,e){this.comparator=t,this.root=e||Vo.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Vo.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Vo.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.inorderTraversal((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new Fo(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new Fo(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new Fo(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new Fo(this.root,t,this.comparator,!0)},t}(),Fo=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),Vo=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw _r();if(this.right.isRed())throw _r();var t=this.left.check();if(t!==this.right.check())throw _r();return t+(this.isRed()?0:1)},t}();Vo.EMPTY=null,Vo.RED=!0,Vo.BLACK=!1,Vo.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw _r()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw _r()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw _r()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw _r()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw _r()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new Vo(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var Uo=function(){function t(t){this.comparator=t,this.data=new Mo(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new qo(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new qo(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),qo=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Bo=new Mo(Zr.comparator);function Go(){return Bo}var jo=new Mo(Zr.comparator);function Ko(){return jo}var zo=new Mo(Zr.comparator);function Jo(){return zo}var Qo=new Uo(Zr.comparator);function Ho(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Qo,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Wo=new Uo(Nr);function Yo(){return Wo}var Xo=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Zo.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(xr.min(),r,Yo(),Go(),Ho())},t}(),Zo=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Br.EMPTY_BYTE_STRING,n,Ho(),Ho(),Ho())},t}(),$o=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},ts=function(t,e){this.targetId=t,this.V=e},es=function(t,e,n,r){void 0===n&&(n=Br.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},ns=function(){function t(){this.S=0,this.D=os(),this.C=Br.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=Ho(),e=Ho(),n=Ho();return this.D.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:_r()}})),new Zo(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=os()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),rs=function(){function t(t){this.W=t,this.G=new Map,this.H=Go(),this.J=is(),this.Y=new Uo(Nr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)r=o[i],this.tt(r,t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,(function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.$(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.$(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.$(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.$(t.resumeToken));break;default:_r()}}))},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach((function(t,r){n.st(r)&&e(r)}))},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(bi(i))if(0===n){var o=new Zr(i.path);this.tt(e,o,pi.newNoDocument(o,xr.min()))}else Er(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach((function(r,i){var o=e.ot(i);if(o){if(r.current&&bi(o.target)){var s=new Zr(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,pi.newNoDocument(s,t))}r.O&&(n.set(i,r.M()),r.L())}}));var r=Ho();this.J.forEach((function(t,n){var i=!0;n.forEachWhile((function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new Xo(t,n,this.Y,this.H,r);return this.H=Go(),this.J=is(),this.Y=new Uo(Nr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new ns,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new Uo(Nr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||br("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new ns),this.W.getRemoteKeysForTarget(t).forEach((function(n){e.tt(t,n,null)}))},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function is(){return new Mo(Zr.comparator)}function os(){return new Mo(Zr.comparator)}var ss={asc:"ASCENDING",desc:"DESCENDING"},as={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},us=function(t,e){this.databaseId=t,this.I=e};function cs(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function hs(t,e){return t.I?e.toBase64():e.toUint8Array()}function ls(t,e){return cs(t,e.toTimestamp())}function fs(t){return Er(!!t),xr.fromTimestamp(function(t){var e=jr(t);return new Rr(e.seconds,e.nanos)}(t))}function ds(t,e){return function(t){return new Fr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function ps(t){var e=Fr.fromString(t);return Er(Vs(e)),e}function ys(t,e){return ds(t.databaseId,e.path)}function vs(t,e){var n=ps(e);if(n.get(1)!==t.databaseId.projectId)throw new vr(yr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new vr(yr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Zr(ws(n))}function ms(t,e){return ds(t.databaseId,e)}function gs(t){var e=ps(t);return 4===e.length?Fr.emptyPath():ws(e)}function bs(t){return new Fr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ws(t){return Er(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Ts(t,e,n){return{name:ys(t,e),fields:n.toProto().mapValue.fields}}function Is(t,e,n){var r=vs(t,e.name),i=fs(e.updateTime),o=new fi({mapValue:{fields:e.fields}}),s=pi.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function _s(t,e){var n;if(e instanceof Eo)n={update:Ts(t,e.key,e.value)};else if(e instanceof Ro)n={delete:ys(t,e.key)};else if(e instanceof So)n={update:Ts(t,e.key,e.data),updateMask:Fs(e.fieldMask)};else{if(!(e instanceof xo))return _r();n={verify:ys(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof oo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof so)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof uo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof ho)return{fieldPath:e.field.canonicalString(),increment:n.A};throw _r()}(0,t)}))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ls(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:_r()}(t,e.precondition)),n}function Es(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?vo.updateTime(fs(t.updateTime)):void 0!==t.exists?vo.exists(t.exists):vo.none()}(e.currentDocument):vo.none(),r=e.updateTransforms?e.updateTransforms.map((function(e){return function(t,e){var n=null;if("setToServerValue"in e)Er("REQUEST_TIME"===e.setToServerValue),n=new oo;else if("appendMissingElements"in e){var r=e.appendMissingElements.values||[];n=new so(r)}else if("removeAllFromArray"in e){var i=e.removeAllFromArray.values||[];n=new uo(i)}else"increment"in e?n=new ho(t,e.increment):_r();var o=Ur.fromServerFormat(e.fieldPath);return new po(o,n)}(t,e)})):[];if(e.update){e.update.name;var i=vs(t,e.update.name),o=new fi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){var e=t.fieldPaths||[];return new qr(e.map((function(t){return Ur.fromServerFormat(t)})))}(e.updateMask);return new So(i,o,s,n,r)}return new Eo(i,o,n,r)}if(e.delete){var a=vs(t,e.delete);return new Ro(a,n)}if(e.verify){var u=vs(t,e.verify);return new xo(u,n)}return _r()}function Ss(t,e){return{documents:[ms(t,e.path)]}}function As(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ms(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ms(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if("=="===t.op){if(hi(t.value))return{unaryFilter:{field:Os(t.field),op:"IS_NAN"}};if(ci(t.value))return{unaryFilter:{field:Os(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(hi(t.value))return{unaryFilter:{field:Os(t.field),op:"IS_NOT_NAN"}};if(ci(t.value))return{unaryFilter:{field:Os(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Os(t.field),op:xs(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:Os(t.field),direction:Rs(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||Wr(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Cs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Cs(e.endAt)),n}function Ds(t){var e=gs(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Er(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Ns(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(t){return function(t){return new Ri(Ps(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)})));var u=null;n.limit&&(u=function(t){var e;return Wr(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=ks(n.startAt));var h=null;return n.endAt&&(h=ks(n.endAt)),Mi(e,i,a,s,u,"F",c,h)}function Ns(t){return t?void 0!==t.unaryFilter?[Ms(t)]:void 0!==t.fieldFilter?[Ls(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return Ns(t)})).reduce((function(t,e){return t.concat(e)})):_r():[]}function Cs(t){return{before:t.before,values:t.position}}function ks(t){var e=!!t.before,n=t.values||[];return new Ci(n,e)}function Rs(t){return ss[t]}function xs(t){return as[t]}function Os(t){return{fieldPath:t.canonicalString()}}function Ps(t){return Ur.fromServerFormat(t.fieldPath)}function Ls(t){return wi.create(Ps(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return _r()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ms(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ps(t.unaryFilter.field);return wi.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ps(t.unaryFilter.field);return wi.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Ps(t.unaryFilter.field);return wi.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=Ps(t.unaryFilter.field);return wi.create(i,"!=",{nullValue:"NULL_VALUE"});default:return _r()}}function Fs(t){var e=[];return t.fields.forEach((function(t){return e.push(t.canonicalString())})),{fieldPaths:e}}function Vs(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Us(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Bs(e)),e=qs(t.get(n),e);return Bs(e)}function qs(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Bs(t){return t+"\x01\x01"}function Gs(t){var e=t.length;if(Er(e>=2),2===e)return Er("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Fr.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&_r(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:_r()}o=s+2}return new Fr(r)}var js=function(t,e){this.seconds=t,this.nanoseconds=e},Ks=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Ks.store="owner",Ks.key="owner";var zs=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};zs.store="mutationQueues",zs.keyPath="userId";var Js=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Js.store="mutations",Js.keyPath="batchId",Js.userMutationsIndex="userMutationsIndex",Js.userMutationsKeyPath=["userId","batchId"];var Qs=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,Us(e)]},t.key=function(t,e,n){return[t,Us(e),n]},t}();Qs.store="documentMutations",Qs.PLACEHOLDER=new Qs;var Hs=function(t,e){this.path=t,this.readTime=e},Ws=function(t,e){this.path=t,this.version=e},Ys=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ys.store="remoteDocuments",Ys.readTimeIndex="readTimeIndex",Ys.readTimeIndexPath="readTime",Ys.collectionReadTimeIndex="collectionReadTimeIndex",Ys.collectionReadTimeIndexPath=["parentPath","readTime"];var Xs=function(t){this.byteSize=t};Xs.store="remoteDocumentGlobal",Xs.key="remoteDocumentGlobalKey";var Zs=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Zs.store="targets",Zs.keyPath="targetId",Zs.queryTargetsIndexName="queryTargetsIndex",Zs.queryTargetsKeyPath=["canonicalId","targetId"];var $s=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};$s.store="targetDocuments",$s.keyPath=["targetId","path"],$s.documentTargetsIndex="documentTargetsIndex",$s.documentTargetsKeyPath=["path","targetId"];var ta=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ta.key="targetGlobalKey",ta.store="targetGlobal";var ea=function(t,e){this.collectionId=t,this.parent=e};ea.store="collectionParents",ea.keyPath=["collectionId","parent"];var na=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};na.store="clientMetadata",na.keyPath="clientId";var ra=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};ra.store="bundles",ra.keyPath="bundleId";var ia=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};ia.store="namedQueries",ia.keyPath="name";var oa=(0,dr.ev)((0,dr.ev)([],(0,dr.ev)((0,dr.ev)([],(0,dr.ev)((0,dr.ev)([],(0,dr.ev)((0,dr.ev)([],[zs.store,Js.store,Qs.store,Ys.store,Zs.store,Ks.store,ta.store,$s.store]),[na.store])),[Xs.store])),[ea.store])),[ra.store,ia.store]),sa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",aa=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},t}(),ua=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},ca=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)}),(function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&_r(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t((function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}}))},t.prototype.toPromise=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.waitFor=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.waitFor(r)},t}(),ha=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new ua,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new da(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=ga(e.target.error);n.ft.reject(new da(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new da(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(br("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new ya(e)},t}(),la=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t((0,i.z$)())&&wr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return br("SimpleDb","Removing database:",t),va(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=(0,i.z$)(),n=t._t(e),r=0<n&&n<10,o=t.Et(e),s=0<o&&o<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t={NODE_ENV:"production",PUBLIC_URL:".",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_GIT_SHA:"",REACT_APP_BACKEND_V2_GET_URL:"https://json.excalidraw.com/api/v2/",REACT_APP_BACKEND_V2_POST_URL:"https://json.excalidraw.com/api/v2/post/",REACT_APP_LIBRARY_URL:"https://libraries.excalidraw.com",REACT_APP_LIBRARY_BACKEND:"https://us-central1-excalidraw-room-persistence.cloudfunctions.net/libraries",REACT_APP_PORTAL_URL:"https://portal.excalidraw.com",REACT_APP_WS_SERVER_URL:"",REACT_APP_FIREBASE_CONFIG:'{"apiKey":"AIzaSyAd15pYlMci_xIp9ko6wkEsDzAAA0Dn0RU","authDomain":"excalidraw-room-persistence.firebaseapp.com","databaseURL":"https://excalidraw-room-persistence.firebaseio.com","projectId":"excalidraw-room-persistence","storageBucket":"excalidraw-room-persistence.appspot.com","messagingSenderId":"654800341332","appId":"1:654800341332:web:4a692de832b55bd57ce0c1"}',REACT_APP_GOOGLE_ANALYTICS_ID:"UA-387204-13",REACT_APP_MATOMO_URL:"https://excalidraw.matomo.cloud/",REACT_APP_CDN_MATOMO_TRACKER_URL:"//cdn.matomo.cloud/excalidraw.matomo.cloud/matomo.js",REACT_APP_MATOMO_SITE_ID:"1",REACT_APP_PLUS_APP:"https://app.excalidraw.com"})||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e,n=this;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:return this.db?[3,2]:(br("SimpleDb","Opening database:",this.name),e=this,[4,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new da(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new vr(yr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new da(t,n))},i.onupgradeneeded=function(t){br("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;n.wt.Rt(e,i.transaction,t.oldVersion,n.version).next((function(){br("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}))]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}}))}))},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return(0,dr.mG)(this,void 0,void 0,(function(){var i,o,s,a,u;return(0,dr.Jh)(this,(function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return(0,dr.Jh)(this,(function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=ha.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch((function(t){return e.abort(t),ca.reject(t)})).toPromise(),u={},s.catch((function(){})),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return c=l.sent(),h="FirebaseError"!==c.name&&o<3,br("SimpleDb","Transaction failed with error:",c.message,"Retrying:",h),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),fa=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return va(this.Pt.delete())},t}(),da=function(t){function e(e,n){var r=this;return(r=t.call(this,yr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return(0,dr.ZT)(e,t),e}(vr);function pa(t){return"IndexedDbTransactionError"===t.name}var ya=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(br("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(br("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),va(n)},t.prototype.add=function(t){return br("SimpleDb","ADD",this.store.name,t,t),va(this.store.add(t))},t.prototype.get=function(t){var e=this;return va(this.store.get(t)).next((function(n){return void 0===n&&(n=null),br("SimpleDb","GET",e.store.name,t,n),n}))},t.prototype.delete=function(t){return br("SimpleDb","DELETE",this.store.name,t),va(this.store.delete(t))},t.prototype.count=function(){return br("SimpleDb","COUNT",this.store.name),va(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.Ft=function(t,e){br("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,(function(t,e,n){return n.delete()}))},t.prototype.Ot=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.$t=function(t){var e=this.cursor({});return new ca((function(n,r){e.onerror=function(t){var e=ga(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.xt=function(t,e){var n=[];return new ca((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new fa(i),s=e(i.primaryKey,i.value,o);if(s instanceof ca){var a=s.catch((function(t){return o.done(),ca.reject(t)}));n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}})).next((function(){return ca.waitFor(n)}))},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function va(t){return new ca((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=ga(t.target.error);n(e)}}))}var ma=!1;function ga(t){var e=la._t((0,i.z$)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new vr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ma||(ma=!0,setTimeout((function(){throw r}),0)),r}}return t}var ba=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return(0,dr.ZT)(e,t),e}(aa);function wa(t,e){var n=Sr(t);return la.It(n.Mt,e)}var Ta=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&bo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&wo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&wo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach((function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(xr.min())}))},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Ho())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Cr(this.mutations,t.mutations,(function(t,e){return Io(t,e)}))&&Cr(this.baseMutations,t.baseMutations,(function(t,e){return Io(t,e)}))},t}(),Ia=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Er(e.mutations.length===r.length);for(var i=Jo(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),_a=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=xr.min()),void 0===o&&(o=xr.min()),void 0===s&&(s=Br.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Ea=function(t){this.Lt=t};function Sa(t,e){if(e.document)return Is(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Zr.fromSegments(e.noDocument.path),r=ka(e.noDocument.readTime),i=pi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Zr.fromSegments(e.unknownDocument.path);return r=ka(e.unknownDocument.version),pi.newUnknownDocument(o,r)}return _r()}function Aa(t,e,n){var r=Da(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:ys(t,e.key),fields:e.data.toProto().mapValue.fields,updateTime:cs(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Ys(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Ca(e.version);return s=e.hasCommittedMutations,new Ys(null,new Hs(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Ca(e.version);return new Ys(new Ws(c,h),null,null,!0,r,i)}return _r()}function Da(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Na(t){var e=new Rr(t[0],t[1]);return xr.fromTimestamp(e)}function Ca(t){var e=t.toTimestamp();return new js(e.seconds,e.nanoseconds)}function ka(t){var e=new Rr(t.seconds,t.nanoseconds);return xr.fromTimestamp(e)}function Ra(t,e){for(var n=(e.baseMutations||[]).map((function(e){return Es(t.Lt,e)})),r=0;r<e.mutations.length-1;++r){var i=e.mutations[r];if(r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform){var o=e.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}var s=e.mutations.map((function(e){return Es(t.Lt,e)})),a=Rr.fromMillis(e.localWriteTimeMs);return new Ta(e.batchId,a,n,s)}function xa(t){var e,n,r=ka(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?ka(t.lastLimboFreeSnapshotVersion):xr.min();return void 0!==t.query.documents?(Er(1===(n=t.query).documents.length),e=Ki(Fi(gs(n.documents[0])))):e=function(t){return Ki(Ds(t))}(t.query),new _a(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Br.fromBase64String(t.resumeToken))}function Oa(t,e){var n,r=Ca(e.snapshotVersion),i=Ca(e.lastLimboFreeSnapshotVersion);n=bi(e.target)?Ss(t.Lt,e.target):As(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Zs(e.targetId,mi(e.target),r,o,e.sequenceNumber,i,n)}function Pa(t){var e=Ds({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?zi(e,e.limit,"L"):e}var La=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return Ma(t).get(e).next((function(t){if(t)return{id:(e=t).bundleId,createTime:ka(e.createTime),version:e.version};var e}))},t.prototype.saveBundleMetadata=function(t,e){return Ma(t).put({bundleId:(n=e).id,createTime:Ca(fs(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return Fa(t).get(e).next((function(t){if(t)return{name:(e=t).name,query:Pa(e.bundledQuery),readTime:ka(e.readTime)};var e}))},t.prototype.saveNamedQuery=function(t,e){return Fa(t).put(function(t){return{name:t.name,readTime:Ca(fs(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function Ma(t){return wa(t,ra.store)}function Fa(t){return wa(t,ia.store)}var Va=function(){function t(){this.Bt=new Ua}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),ca.resolve()},t.prototype.getCollectionParents=function(t,e){return ca.resolve(this.Bt.getEntries(e))},t}(),Ua=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Uo(Fr.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Uo(Fr.comparator)).toArray()},t}(),qa=function(){function t(){this.qt=new Ua}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener((function(){n.qt.add(e)}));var o={collectionId:r,parent:Us(i)};return Ba(t).put(o)}return ca.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[kr(e),""],!1,!0);return Ba(t).Nt(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Gs(o.parent))}return n}))},t}();function Ba(t){return wa(t,ea.store)}var Ga={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ja=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function Ka(t,e,n){var r=t.store(Js.store),i=t.store(Qs.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},(function(t,e,n){return a++,n.delete()}));o.push(u.next((function(){Er(1===a)})));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=Qs.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return ca.waitFor(o).next((function(){return c}))}function za(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _r();e=t.noDocument}return JSON.stringify(e).length}ja.DEFAULT_COLLECTION_PERCENTILE=10,ja.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ja.DEFAULT=new ja(41943040,ja.DEFAULT_COLLECTION_PERCENTILE,ja.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ja.DISABLED=new ja(-1,0,0);var Ja=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return Er(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ha(t).Ot({index:Js.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=Wa(t),s=Ha(t);return s.add({}).next((function(a){Er("number"==typeof a);for(var u=new Ta(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return _s(t.Lt,e)})),i=n.mutations.map((function(e){return _s(t.Lt,e)}));return new Js(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new Uo((function(t,e){return Nr(t.canonicalString(),e.canonicalString())})),f=0,d=r;f<d.length;f++){var p=d[f],y=Qs.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,Qs.PLACEHOLDER))}return l.forEach((function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((function(){i.Qt[a]=u.keys()})),ca.waitFor(h).next((function(){return u}))}))},t.prototype.lookupMutationBatch=function(t,e){var n=this;return Ha(t).get(e).next((function(t){return t?(Er(t.userId===n.userId),Ra(n.R,t)):null}))},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?ca.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next((function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null}))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Ha(t).Ot({index:Js.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Er(e.batchId>=r),o=Ra(n.R,e)),i.done()})).next((function(){return o}))},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Ha(t).Ot({index:Js.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ha(t).Nt(Js.userMutationsIndex,n).next((function(t){return t.map((function(t){return Ra(e.R,t)}))}))},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=Qs.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Wa(t).Ot({range:i},(function(r,i,s){var a=r[0],u=r[1],c=r[2],h=Gs(u);if(a===n.userId&&e.path.isEqual(h))return Ha(t).get(c).next((function(t){if(!t)throw _r();Er(t.userId===n.userId),o.push(Ra(n.R,t))}));s.done()})).next((function(){return o}))},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Uo(Nr),i=[];return e.forEach((function(e){var o=Qs.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=Wa(t).Ot({range:s},(function(t,i,o){var s=t[0],a=t[1],u=t[2],c=Gs(a);s===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()}));i.push(a)})),ca.waitFor(i).next((function(){return n.Wt(t,r)}))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=Qs.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new Uo(Nr);return Wa(t).Ot({range:s},(function(t,e,o){var s=t[0],u=t[1],c=t[2],h=Gs(u);s===n.userId&&r.isPrefixOf(h)?h.length===i&&(a=a.add(c)):o.done()})).next((function(){return n.Wt(t,a)}))},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Ha(t).get(e).next((function(t){if(null===t)throw _r();Er(t.userId===n.userId),r.push(Ra(n.R,t))})))})),ca.waitFor(i).next((function(){return r}))},t.prototype.removeMutationBatch=function(t,e){var n=this;return Ka(t.Mt,this.userId,e).next((function(r){return t.addOnCommittedListener((function(){n.Gt(e.batchId)})),ca.forEach(r,(function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)}))}))},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next((function(n){if(!n)return ca.resolve();var r=IDBKeyRange.lowerBound(Qs.prefixForUser(e.userId)),i=[];return Wa(t).Ot({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Gs(t[1]);i.push(o)}else r.done()})).next((function(){Er(0===i.length)}))}))},t.prototype.containsKey=function(t,e){return Qa(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Ya(t).get(this.userId).next((function(t){return t||new zs(e.userId,-1,"")}))},t}();function Qa(t,e,n){var r=Qs.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Wa(t).Ot({range:o,kt:!0},(function(t,n,r){var o=t[0],a=t[1];t[2],o===e&&a===i&&(s=!0),r.done()})).next((function(){return s}))}function Ha(t){return wa(t,Js.store)}function Wa(t){return wa(t,Qs.store)}function Ya(t){return wa(t,zs.store)}var Xa=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Za=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next((function(n){var r=new Xa(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(t){return xr.fromTimestamp(new Rr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)}))},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next((function(){return n.Xt(t).next((function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)}))}))},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next((function(){return $a(t).delete(e.targetId)})).next((function(){return n.Xt(t)})).next((function(e){return Er(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)}))},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return $a(t).Ot((function(s,a){var u=xa(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))})).next((function(){return ca.waitFor(o)})).next((function(){return i}))},t.prototype.forEachTarget=function(t,e){return $a(t).Ot((function(t,n){var r=xa(n);e(r)}))},t.prototype.Xt=function(t){return tu(t).get(ta.key).next((function(t){return Er(null!==t),t}))},t.prototype.Zt=function(t,e){return tu(t).put(ta.key,e)},t.prototype.te=function(t,e){return $a(t).put(Oa(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next((function(t){return t.targetCount}))},t.prototype.getTargetData=function(t,e){var n=mi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return $a(t).Ot({range:r,index:Zs.queryTargetsIndexName},(function(t,n,r){var o=xa(n);gi(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=eu(t);return e.forEach((function(e){var s=Us(e.path);i.push(o.put(new $s(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))})),ca.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=eu(t);return ca.forEach(e,(function(e){var o=Us(e.path);return ca.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])}))},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=eu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=eu(t),i=Ho();return r.Ot({range:n,kt:!0},(function(t,e,n){var r=Gs(t[1]),o=new Zr(r);i=i.add(o)})).next((function(){return i}))},t.prototype.containsKey=function(t,e){var n=Us(e.path),r=IDBKeyRange.bound([n],[kr(n)],!1,!0),i=0;return eu(t).Ot({index:$s.documentTargetsIndex,kt:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.lt=function(t,e){return $a(t).get(e).next((function(t){return t?xa(t):null}))},t}();function $a(t){return wa(t,Zs.store)}function tu(t){return wa(t,ta.store)}function eu(t){return wa(t,$s.store)}function nu(t){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){if(t.code!==yr.FAILED_PRECONDITION||t.message!==sa)throw t;return br("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function ru(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Nr(n,i);return 0===s?Nr(r,o):s}var iu=function(){function t(t){this.ne=t,this.buffer=new Uo(ru),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ru(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),ou=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;br("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(function(){return(0,dr.mG)(e,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return pa(e=n.sent())?(br("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,nu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),su=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return ca.resolve(pr.o);var r=new iu(e);return this.ae.forEachTarget(t,(function(t){return r.re(t.sequenceNumber)})).next((function(){return n.ae.le(t,(function(t){return r.re(t)}))})).next((function(){return r.maxValue}))},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(br("LruGarbageCollector","Garbage collection skipped; disabled"),ca.resolve(Ga)):this.getCacheSize(t).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(br("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Ga):n.fe(t,e)}))},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,s,a,u,c,h=this,l=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(e){return e>h.params.maximumSequenceNumbersToCollect?(br("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+e),r=h.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),h.nthSequenceNumber(t,r)})).next((function(r){return n=r,a=Date.now(),h.removeTargets(t,n,e)})).next((function(e){return i=e,u=Date.now(),h.removeOrphanedDocuments(t,n)})).next((function(t){return c=Date.now(),gr()<=o.in.DEBUG&&br("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-l)+"ms\n\tDetermined least recently used "+r+" in "+(a-s)+"ms\n\tRemoved "+i+" targets in "+(u-a)+"ms\n\tRemoved "+t+" documents in "+(c-u)+"ms\nTotal Duration: "+(c-l)+"ms"),ca.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})}))},t}(),au=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new su(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.de=function(t){var e=0;return this.le(t,(function(t){e++})).next((function(){return e}))},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,(function(t,n){return e(n)}))},t.prototype.addReference=function(t,e,n){return uu(t,n)},t.prototype.removeReference=function(t,e,n){return uu(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return uu(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Ya(t).$t((function(r){return Qa(t,r,e).next((function(t){return t&&(n=!0),ca.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,(function(s,a){if(a<=e){var u=n._e(t,s).next((function(e){if(!e)return o++,r.getEntry(t,s).next((function(){return r.removeEntry(s),eu(t).delete([0,Us(s.path)])}))}));i.push(u)}})).next((function(){return ca.waitFor(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return uu(t,e)},t.prototype.we=function(t,e){var n,r=eu(t),i=pr.o;return r.Ot({index:$s.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),a=r.sequenceNumber;0===o?(i!==pr.o&&e(new Zr(Gs(n)),i),i=a,n=s):i=pr.o})).next((function(){i!==pr.o&&e(new Zr(Gs(n)),i)}))},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function uu(t,e){return eu(t).put(function(t,e){return new $s(0,Us(t.path),e)}(e,t.currentSequenceNumber))}var cu=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];if(this.equalsFn(s,t))return a}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Pr(this.inner,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],a=o[1];t(s,a)}}))},t.prototype.isEmpty=function(){return Lr(this.inner)},t}(),hu=function(){function t(){this.changes=new cu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:xr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:pi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ca.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),lu=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return pu(t).put(yu(e),n)},t.prototype.removeEntry=function(t,e){var n=pu(t),r=yu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.me(t,r)}))},t.prototype.getEntry=function(t,e){var n=this;return pu(t).get(yu(e)).next((function(t){return n.ye(e,t)}))},t.prototype.ge=function(t,e){var n=this;return pu(t).get(yu(e)).next((function(t){return{document:n.ye(e,t),size:za(t)}}))},t.prototype.getEntries=function(t,e){var n=this,r=Go();return this.pe(t,e,(function(t,e){var i=n.ye(t,e);r=r.insert(t,i)})).next((function(){return r}))},t.prototype.Ee=function(t,e){var n=this,r=Go(),i=new Mo(Zr.comparator);return this.pe(t,e,(function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,za(e))})).next((function(){return{documents:r,Te:i}}))},t.prototype.pe=function(t,e,n){if(e.isEmpty())return ca.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return pu(t).Ot({range:r},(function(t,e,r){for(var s=Zr.fromSegments(t);o&&Zr.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=Go(),o=e.path.length+1,s={};if(n.isEqual(xr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Da(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=Ys.collectionReadTimeIndex}return pu(t).Ot(s,(function(t,n,s){if(t.length===o){var a=Sa(r.R,n);e.path.isPrefixOf(a.key.path)?Wi(e,a)&&(i=i.insert(a.key,a)):s.done()}})).next((function(){return i}))},t.prototype.newChangeBuffer=function(t){return new fu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return du(t).get(Xs.key).next((function(t){return Er(!!t),t}))},t.prototype.me=function(t,e){return du(t).put(Xs.key,e)},t.prototype.ye=function(t,e){if(e){var n=Sa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(xr.min()))return n}return pi.newInvalidDocument(t)},t}(),fu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new cu((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return(0,dr.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new Uo((function(t,e){return Nr(t.canonicalString(),e.canonicalString())}));return this.changes.forEach((function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Aa(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=za(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Aa(e.Ie.R,pi.newNoDocument(o,xr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))})),i.forEach((function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))})),n.push(this.Ie.updateMetadata(t,r)),ca.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next((function(t){return n.Ae.set(e,t.size),t.document}))},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next((function(t){var e=t.documents;return t.Te.forEach((function(t,e){n.Ae.set(t,e)})),e}))},e}(hu);function du(t){return wa(t,Xs.store)}function pu(t){return wa(t,Ys.store)}function yu(t){return t.path.toArray()}var vu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Er(n<r&&n>=0&&r<=11);var o=new ha("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(Ks.store)}(t),function(t){t.createObjectStore(zs.store,{keyPath:zs.keyPath}),t.createObjectStore(Js.store,{keyPath:Js.keyPath,autoIncrement:!0}).createIndex(Js.userMutationsIndex,Js.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Qs.store)}(t),mu(t),function(t){t.createObjectStore(Ys.store)}(t));var s=ca.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore($s.store),t.deleteObjectStore(Zs.store),t.deleteObjectStore(ta.store)}(t),mu(t)),s=s.next((function(){return function(t){var e=t.store(ta.store),n=new ta(0,0,xr.min().toTimestamp(),0);return e.put(ta.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(Js.store).Nt().next((function(n){t.deleteObjectStore(Js.store),t.createObjectStore(Js.store,{keyPath:Js.keyPath,autoIncrement:!0}).createIndex(Js.userMutationsIndex,Js.userMutationsKeyPath,{unique:!0});var r=e.store(Js.store),i=n.map((function(t){return r.put(t)}));return ca.waitFor(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(na.store,{keyPath:na.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.Re(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Xs.store)}(t),i.be(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ve(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.Pe(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Ys.store);e.createIndex(Ys.readTimeIndex,Ys.readTimeIndexPath,{unique:!1}),e.createIndex(Ys.collectionReadTimeIndex,Ys.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.Ve(o)}))),n<11&&r>=11&&(s=s.next((function(){!function(t){t.createObjectStore(ra.store,{keyPath:ra.keyPath})}(t),function(t){t.createObjectStore(ia.store,{keyPath:ia.keyPath})}(t)}))),s},t.prototype.be=function(t){var e=0;return t.store(Ys.store).Ot((function(t,n){e+=za(n)})).next((function(){var n=new Xs(e);return t.store(Xs.store).put(Xs.key,n)}))},t.prototype.Re=function(t){var e=this,n=t.store(zs.store),r=t.store(Js.store);return n.Nt().next((function(n){return ca.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(Js.userMutationsIndex,i).next((function(r){return ca.forEach(r,(function(r){Er(r.userId===n.userId);var i=Ra(e.R,r);return Ka(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ve=function(t){var e=t.store($s.store),n=t.store(Ys.store);return t.store(ta.store).get(ta.key).next((function(t){var r=[];return n.Ot((function(n,i){var o=new Fr(n),s=function(t){return[0,Us(t)]}(o);r.push(e.get(s).next((function(n){return n?ca.resolve():function(n){return e.put(new $s(0,Us(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return ca.waitFor(r)}))}))},t.prototype.Pe=function(t,e){t.createObjectStore(ea.store,{keyPath:ea.keyPath});var n=e.store(ea.store),r=new Ua,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:Us(i)})}};return e.store(Ys.store).Ot({kt:!0},(function(t,e){var n=new Fr(t);return i(n.popLast())})).next((function(){return e.store(Qs.store).Ot({kt:!0},(function(t,e){t[0];var n=t[1],r=(t[2],Gs(n));return i(r.popLast())}))}))},t.prototype.Ve=function(t){var e=this,n=t.store(Zs.store);return n.Ot((function(t,r){var i=xa(r),o=Oa(e.R,i);return n.put(o)}))},t}();function mu(t){t.createObjectStore($s.store,{keyPath:$s.keyPath}).createIndex($s.documentTargetsIndex,$s.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Zs.store,{keyPath:Zs.keyPath}).createIndex(Zs.queryTargetsIndexName,Zs.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ta.store)}var gu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",bu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new vr(yr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new au(this,i),this.Le=n+"main",this.R=new Ea(u),this.Be=new la(this.Le,11,new vu(this.R)),this.qe=new Za(this.referenceDelegate,this.R),this.Ut=new qa,this.Ue=function(t,e){return new lu(t,e)}(this.R,this.Ut),this.Qe=new La,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&wr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new vr(yr.FAILED_PRECONDITION,gu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(e){return t.qe.getHighestSequenceNumber(e)}))})).then((function(e){t.Ne=new pr(e,t.De)})).then((function(){t.xe=!0})).catch((function(e){return t.Be&&t.Be.close(),Promise.reject(e)}))},t.prototype.He=function(t){var e=this;return this.Me=function(n){return(0,dr.mG)(e,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){return this.started?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt((function(n){return(0,dr.mG)(e,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return(0,dr.mG)(e,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return Tu(e).put(new na(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(e).next((function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(e)})).next((function(n){return t.isPrimary&&!n?t.Xe(e).next((function(){return!1})):!!n&&t.Ze(e).next((function(){return!0}))}))})).catch((function(e){if(pa(e))return br("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return br("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((function(e){t.isPrimary!==e&&t.Se.enqueueRetryable((function(){return t.Me(e)})),t.isPrimary=e}))},t.prototype.Je=function(t){var e=this;return wu(t).get(Ks.key).next((function(t){return ca.resolve(e.tn(t))}))},t.prototype.en=function(t){return Tu(t).delete(this.clientId)},t.prototype.nn=function(){return(0,dr.mG)(this,void 0,void 0,(function(){var t,e,n,r,i=this;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(t){var e=wa(t,na.store);return e.Nt().next((function(t){var n=i.rn(t,18e5),r=t.filter((function(t){return-1===n.indexOf(t)}));return ca.forEach(r,(function(t){return e.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(t=o.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)r=n[e],this.Ke.removeItem(this.on(r.clientId));o.label=2;case 2:return[2]}}))}))},t.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?ca.resolve(!0):wu(t).get(Ks.key).next((function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new vr(yr.FAILED_PRECONDITION,gu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Tu(t).Nt().next((function(t){return void 0===e.rn(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&br("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},t.prototype.shutdown=function(){return(0,dr.mG)(this,void 0,void 0,(function(){var t=this;return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Ks.store,na.store],(function(e){var n=new ba(e,pr.o);return t.Xe(n).next((function(){return t.en(n)}))}))];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}}))}))},t.prototype.rn=function(t,e){var n=this;return t.filter((function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)}))},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return Tu(e).Nt().next((function(e){return t.rn(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return Ja.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;br("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Be.runTransaction(t,o,oa,(function(o){return i=new ba(o,r.Ne?r.Ne.next():pr.o),"readwrite-primary"===e?r.Je(i).next((function(t){return!!t||r.Ye(i)})).next((function(e){if(!e)throw wr("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Se.enqueueRetryable((function(){return r.Me(!1)})),new vr(yr.FAILED_PRECONDITION,sa);return n(i)})).next((function(t){return r.Ze(i).next((function(){return t}))})):r.dn(i).next((function(){return n(i)}))})).then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.dn=function(t){var e=this;return wu(t).get(Ks.key).next((function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new vr(yr.FAILED_PRECONDITION,gu)}))},t.prototype.Ze=function(t){var e=new Ks(this.clientId,this.allowTabSynchronization,Date.now());return wu(t).put(Ks.key,e)},t.yt=function(){return la.yt()},t.prototype.Xe=function(t){var e=this,n=wu(t);return n.get(Ks.key).next((function(t){return e.tn(t)?(br("IndexedDbPersistence","Releasing primary lease."),n.delete(Ks.key)):ca.resolve()}))},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(wr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground="visible"===t.document.visibilityState,t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget((function(){return e.shutdown()}))},this.window.addEventListener("unload",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return br("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return wr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){wr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function wu(t){return wa(t,Ks.store)}function Tu(t){return wa(t,na.store)}function Iu(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var _u=function(t,e){this.progress=t,this.wn=e},Eu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next((function(r){return n.yn(t,e,r)}))},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next((function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t}))},t.prototype.gn=function(t,e){t.forEach((function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)}))},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next((function(e){return n.En(t,e).next((function(){return e}))}))},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next((function(t){return n.gn(e,t)}))},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Zr.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):Gi(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Zr(e)).next((function(t){var e=Ko();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=Ko();return this.Ut.getCollectionParents(t,i).next((function(s){return ca.forEach(s,(function(s){var a=function(t,e){return new Li(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next((function(t){t.forEach((function(t,e){o=o.insert(t,e)}))}))})).next((function(){return o}))}))},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next((function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)})).next((function(e){return i=e,o.Rn(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=pi.newInvalidDocument(c),r=r.insert(c,h)),wo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}}))})).next((function(){return r.forEach((function(t,n){Wi(e,n)||(r=r.remove(t))})),r}))},t.prototype.Rn=function(t,e,n){for(var r=Ho(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof So&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next((function(t){return t.forEach((function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))})),c}))},t}(),Su=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=Ho(),i=Ho(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Au=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(xr.min())?this.Dn(t,e):this.Sn.pn(t,r).next((function(s){var a=i.Cn(e,s);return(Vi(e)||Ui(e))&&i.Nn(e.limitType,a,r,n)?i.Dn(t,e):(gr()<=o.in.DEBUG&&br("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Hi(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next((function(t){return a.forEach((function(e){t=t.insert(e.key,e)})),t})))}))},t.prototype.Cn=function(t,e){var n=new Uo(Yi(t));return e.forEach((function(e,r){Wi(t,r)&&(n=n.add(r))})),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return gr()<=o.in.DEBUG&&br("QueryEngine","Using full collection scan to execute query:",Hi(e)),this.Sn.getDocumentsMatchingQuery(t,e,xr.min())},t}(),Du=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new Mo(Nr),this.kn=new cu((function(t){return mi(t)}),gi),this.On=xr.min(),this._n=t.getMutationQueue(n),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Eu(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.collect(n,e.Fn)}))},t}();function Nu(t,e,n,r){return new Du(t,e,n,r)}function Cu(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i,o;return(0,dr.Jh)(this,(function(s){switch(s.label){case 0:return n=Sr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(t){var o;return n._n.getAllMutationBatches(t).next((function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Eu(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)})).next((function(e){for(var n=[],r=[],s=Ho(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];s=s.add(f.key)}}for(var d=0,p=e;d<p.length;d++){var y=p[d];r.push(y.batchId);for(var v=0,m=y.mutations;v<m.length;v++){var g=m[v];s=s.add(g.key)}}return i.pn(t,s).next((function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function ku(t,e){var n=Sr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(t){var r=e.batch.keys(),i=n.$n.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=ca.resolve();return o.forEach((function(t){s=s.next((function(){return r.getEntry(e,t)})).next((function(e){var o=n.docVersions.get(t);Er(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))}))})),s.next((function(){return t._n.removeMutationBatch(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}function Ru(t){var e=Sr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(function(t){return e.qe.getLastRemoteSnapshotVersion(t)}))}function xu(t,e){var n=Sr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(t){var o=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach((function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next((function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)})));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Er(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}}));var a=Go();if(e.documentUpdates.forEach((function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),s.push(Ou(t,o,e.documentUpdates,r,void 0).next((function(t){a=t}))),!r.isEqual(xr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next((function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)}));s.push(u)}return ca.waitFor(s).next((function(){return o.apply(t)})).next((function(){return n.Mn.En(t,a)})).next((function(){return a}))})).then((function(t){return n.Fn=i,t}))}function Ou(t,e,n,r,i){var o=Ho();return n.forEach((function(t){return o=o.add(t)})),e.getEntries(t,o).next((function(t){var o=Go();return n.forEach((function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(xr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):br("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)})),o}))}function Pu(t,e){var n=Sr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)}))}function Lu(t,e){var n=Sr(t);return n.persistence.runTransaction("Allocate target","readwrite",(function(t){var r;return n.qe.getTargetData(t,e).next((function(i){return i?(r=i,ca.resolve(r)):n.qe.allocateTargetId(t).next((function(i){return r=new _a(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t}))}function Mu(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r,i,o,s;return(0,dr.Jh)(this,(function(a){switch(a.label){case 0:r=Sr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(t){return r.persistence.referenceDelegate.removeTarget(t,i)}))];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!pa(s=a.sent()))throw s;return br("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}}))}))}function Fu(t,e,n){var r=Sr(t),i=xr.min(),o=Ho();return r.persistence.runTransaction("Execute query","readonly",(function(t){return function(t,e,n){var r=Sr(t),i=r.kn.get(n);return void 0!==i?ca.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,Ki(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:xr.min(),n?o:Ho())})).next((function(t){return{documents:t,Bn:o}}))}))}function Vu(t,e){var n=Sr(t),r=Sr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(t){return r.lt(t,e).next((function(t){return t?t.target:null}))}))}function Uu(t){var e=Sr(t);return e.persistence.runTransaction("Get new document changes","readonly",(function(t){return function(t,e,n){var r=Sr(t),i=Go(),o=Da(n),s=pu(e),a=IDBKeyRange.lowerBound(o,!0);return s.Ot({index:Ys.readTimeIndex,range:a},(function(t,e){var n=Sa(r.R,e);i=i.insert(n.key,n),o=e.readTime})).next((function(){return{wn:i,readTime:Na(o)}}))}(e.$n,t,e.On)})).then((function(t){var n=t.wn,r=t.readTime;return e.On=r,n}))}function qu(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){return[2,(e=Sr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return function(t){var e=pu(t),n=xr.min();return e.Ot({index:Ys.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=Na(e.readTime)),r.done()})).next((function(){return n}))}(t)})).then((function(t){e.On=t}))]}))}))}function Bu(t,e,n,r){return(0,dr.mG)(this,void 0,void 0,(function(){var i,o,s,a,u,c,h,l,f,d;return(0,dr.Jh)(this,(function(p){switch(p.label){case 0:for(i=Sr(t),o=Ho(),s=Go(),a=Jo(),u=0,c=n;u<c.length;u++)h=c[u],l=e.qn(h.metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Qn(h.metadata.readTime));return f=i.$n.newChangeBuffer({trackRemovals:!0}),[4,Lu(i,function(t){return Ki(Fi(Fr.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",(function(t){return Ou(t,f,s,xr.min(),a).next((function(e){return f.apply(t),e})).next((function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next((function(){return i.qe.addMatchingKeys(t,o,d.targetId)})).next((function(){return i.Mn.En(t,e)})).next((function(){return e}))}))}))]}}))}))}function Gu(t,e,n){return void 0===n&&(n=Ho()),(0,dr.mG)(this,void 0,void 0,(function(){var r,i;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return[4,Lu(t,Ki(Pa(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Sr(t)).persistence.runTransaction("Save named query","readwrite",(function(t){var o=fs(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(Br.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next((function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)})).next((function(){return i.qe.addMatchingKeys(t,n,r.targetId)})).next((function(){return i.Qe.saveNamedQuery(t,e)}))}))]}}))}))}var ju=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return ca.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:fs(n.createTime)}),ca.resolve()},t.prototype.getNamedQuery=function(t,e){return ca.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:Pa(t.bundledQuery),readTime:fs(t.readTime)}}(e)),ca.resolve()},t}(),Ku=function(){function t(){this.Wn=new Uo(zu.Gn),this.zn=new Uo(zu.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new zu(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach((function(t){return n.addReference(t,e)}))},t.prototype.removeReference=function(t,e){this.Yn(new zu(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach((function(t){return n.removeReference(t,e)}))},t.prototype.Zn=function(t){var e=this,n=new Zr(new Fr([])),r=new zu(n,t),i=new zu(n,t+1),o=[];return this.zn.forEachInRange([r,i],(function(t){e.Yn(t),o.push(t.key)})),o},t.prototype.ts=function(){var t=this;this.Wn.forEach((function(e){return t.Yn(e)}))},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Zr(new Fr([])),n=new zu(e,t),r=new zu(e,t+1),i=Ho();return this.zn.forEachInRange([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.containsKey=function(t){var e=new zu(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),zu=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Zr.comparator(t.key,e.key)||Nr(t.ns,e.ns)},t.Hn=function(t,e){return Nr(t.ns,e.ns)||Zr.comparator(t.key,e.key)},t}(),Ju=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new Uo(zu.Gn)}return t.prototype.checkEmpty=function(t){return ca.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var o=new Ta(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new zu(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return ca.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return ca.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.cs(n),i=r<0?0:r;return ca.resolve(this._n.length>i?this._n[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return ca.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return ca.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new zu(e,0),i=new zu(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],(function(t){var e=n.os(t.ns);o.push(e)})),ca.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Uo(Nr);return e.forEach((function(t){var e=new zu(t,0),i=new zu(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],(function(t){r=r.add(t.ns)}))})),ca.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Zr.isDocumentKey(i)||(i=i.child(""));var o=new zu(new Zr(i),0),s=new Uo(Nr);return this.rs.forEachWhile((function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)}),o),ca.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.os(t);null!==r&&n.push(r)})),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Er(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return ca.forEach(e.mutations,(function(i){var o=new zu(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((function(){n.rs=r}))},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new zu(e,0),r=this.rs.firstAfterOrEqual(n);return ca.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return this._n.length,ca.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),Qu=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new Mo(Zr.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return ca.resolve(n?n.document.clone():pi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=Go();return e.forEach((function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():pi.newInvalidDocument(t))})),ca.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=Go(),i=new Zr(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.key,u=s.value,c=u.document,h=u.readTime;if(!e.path.isPrefixOf(a.path))break;h.compareTo(n)<=0||Wi(e,c)&&(r=r.insert(c.key,c.clone()))}return ca.resolve(r)},t.prototype.fs=function(t,e){return ca.forEach(this.docs,(function(t){return e(t)}))},t.prototype.newChangeBuffer=function(t){return new Hu(this)},t.prototype.getSize=function(t){return ca.resolve(this.size)},t}(),Hu=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return(0,dr.ZT)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)})),ca.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(hu),Wu=function(){function t(t){this.persistence=t,this.ds=new cu((function(t){return mi(t)}),gi),this.lastRemoteSnapshotVersion=xr.min(),this.highestTargetId=0,this.ws=0,this._s=new Ku,this.targetCount=0,this.ys=Xa.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach((function(t,n){return e(n)})),ca.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return ca.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return ca.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),ca.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),ca.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Xa(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,ca.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),ca.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,ca.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach((function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)})),ca.waitFor(o).next((function(){return i}))},t.prototype.getTargetCount=function(t){return ca.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return ca.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),ca.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((function(e){i.push(r.markPotentiallyOrphaned(t,e))})),ca.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),ca.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return ca.resolve(n)},t.prototype.containsKey=function(t,e){return ca.resolve(this._s.containsKey(e))},t}(),Yu=function(){function t(t,e){var n=this;this.gs={},this.Ne=new pr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Wu(this),this.Ut=new Va,this.Ue=function(t,e){return new Qu(t,(function(t){return n.referenceDelegate.ps(t)}))}(this.Ut),this.R=new Ea(e),this.Qe=new ju(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new Ju(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;br("MemoryPersistence","Starting transaction:",t);var i=new Xu(this.Ne.next());return this.referenceDelegate.Es(),n(i).next((function(t){return r.referenceDelegate.Ts(i).next((function(){return t}))})).toPromise().then((function(t){return i.raiseOnCommittedEvent(),t}))},t.prototype.Is=function(t,e){return ca.or(Object.values(this.gs).map((function(n){return function(){return n.containsKey(t,e)}})))},t}(),Xu=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return(0,dr.ZT)(e,t),e}(aa),Zu=function(){function t(t){this.persistence=t,this.As=new Ku,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw _r()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),ca.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),ca.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),ca.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach((function(t){return n.vs.add(t.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((function(t){t.forEach((function(t){return n.vs.add(t.toString())}))})).next((function(){return r.removeTargetData(t,e)}))},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ca.forEach(this.vs,(function(r){var i=Zr.fromPath(r);return e.Ps(t,i).next((function(t){t||n.removeEntry(i)}))})).next((function(){return e.Rs=null,n.apply(t)}))},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next((function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())}))},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return ca.or([function(){return ca.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),$u=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function tc(t,e){return"firestore_clients_"+t+"_"+e}function ec(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function nc(t,e){return"firestore_targets_"+t+"_"+e}$u.UNAUTHENTICATED=new $u(null),$u.GOOGLE_CREDENTIALS=new $u("google-credentials-uid"),$u.FIRST_PARTY=new $u("first-party-uid");var rc=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new vr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(wr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),ic=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new vr(i.error.code,i.error.message)),o?new t(e,i.state,r):(wr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),oc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Yo(),s=0;i&&s<r.activeTargetIds.length;++s)i=Xr(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(wr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),sc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(wr("SharedClientState","Failed to parse online state: "+e),null)},t}(),ac=function(){function t(){this.activeTargetIds=Yo()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),uc=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new Mo(Nr),this.started=!1,this.Os=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.$s=tc(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new ac),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return(0,dr.mG)(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,a,u,c,h,l=this;return(0,dr.Jh)(this,(function(f){switch(f.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(tc(this.persistenceKey,r)))&&(o=oc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.Os;u<c.length;u++)h=c[u],this.Fs(h);return this.Os=[],this.window.addEventListener("unload",(function(){return l.shutdown()})),this.started=!0,[2]}}))}))},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(nc(this.persistenceKey,t));if(n){var r=ic.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(nc(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach((function(t){r.Hs(t)})),this.currentUser=t,n.forEach((function(t){r.addPendingMutation(t)}))},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return br("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){br("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){br("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(br("SharedClientState","EVENT",n.key,n.newValue),n.key===this.$s)return void wr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return(0,dr.mG)(e,void 0,void 0,(function(){var t,e,r,i,o,s;return(0,dr.Jh)(this,(function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=pr.o;if(null!=t)try{var n=JSON.parse(t);Er("number"==typeof n),e=n}catch(t){wr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==pr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.Os.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new rc(this.currentUser,t,e,n),i=ec(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=ec(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){var e={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(e))},t.prototype.Ys=function(t,e,n){var r=nc(this.persistenceKey,t),i=new ic(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return oc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return rc.Vs(new $u(i),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return ic.Vs(r,e)},t.prototype.js=function(t){return sc.Vs(t)},t.prototype.ii=function(t){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(br("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||a.push(t)})),this.syncEngine.hi(s,a).then((function(){n.ks=r}))},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Yo();return t.forEach((function(t,n){e=e.unionWith(n.activeTargetIds)})),e},t}(),cc=function(){function t(){this.li=new ac,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new ac,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),hc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),lc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){br("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){br("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),fc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},dc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),pc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n}return(0,dr.ZT)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise((function(i,o){var s=new fr;s.listenOnce(ur.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case ar.NO_ERROR:var e=s.getResponseJson();br("Connection","XHR received:",JSON.stringify(e)),i(e);break;case ar.TIMEOUT:br("Connection",'RPC "'+t+'" timed out'),o(new vr(yr.DEADLINE_EXCEEDED,"Request time out"));break;case ar.HTTP_ERROR:var n=s.getStatus();if(br("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(yr).indexOf(e)>=0?e:yr.UNKNOWN}(r.status);o(new vr(a,r.message))}else o(new vr(yr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new vr(yr.UNAVAILABLE,"Connection failed."));break;default:_r()}}finally{br("Connection",'RPC "'+t+'" completed.')}}));var a=JSON.stringify(r);s.send(e,"POST",a,n,15)}))},e.prototype.$i=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=or(),o=sr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(s.initMessageHeaders,e),(0,i.uI)()||(0,i.b$)()||(0,i.d)()||(0,i.w1)()||(0,i.Mn)()||(0,i.ru)()||(s.httpHeadersOverwriteParam="$httpHeaders");var a=n.join("");br("Connection","Creating WebChannel: "+a,s);var u=r.createWebChannel(a,s),c=!1,h=!1,l=new dc({Ei:function(t){h?br("Connection","Not sending because WebChannel is closed:",t):(c||(br("Connection","Opening WebChannel transport."),u.open(),c=!0),br("Connection","WebChannel sending:",t),u.send(t))},Ti:function(){return u.close()}}),f=function(t,e,n){t.listen(e,(function(t){try{n(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return f(u,lr.EventType.OPEN,(function(){h||br("Connection","WebChannel transport opened.")})),f(u,lr.EventType.CLOSE,(function(){h||(h=!0,br("Connection","WebChannel transport closed"),l.Vi())})),f(u,lr.EventType.ERROR,(function(t){h||(h=!0,Tr("Connection","WebChannel transport errored:",t),l.Vi(new vr(yr.UNAVAILABLE,"The operation could not be completed")))})),f(u,lr.EventType.MESSAGE,(function(t){var e;if(!h){var n=t.data[0];Er(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){br("Connection","WebChannel received error:",i);var o=i.status,s=function(t){var e=Co[t];if(void 0!==e)return Lo(e)}(o),a=i.message;void 0===s&&(s=yr.INTERNAL,a="Unknown error status: "+o+" with message "+i.message),h=!0,l.Vi(new vr(s,a)),u.close()}else br("Connection","WebChannel received:",n),l.Si(n)}})),f(o,cr.STAT_EVENT,(function(t){t.stat===hr.PROXY?br("Connection","Detected buffering proxy"):t.stat===hr.NOPROXY&&br("Connection","Detected no buffering proxy")})),setTimeout((function(){l.Pi()}),0),l},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.Di=e+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);br("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then((function(t){return br("RestConnection","Received: ",t),t}),(function(e){throw Tr("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e}))},t.prototype.Oi=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.3.3",t["X-Firebase-GMPID"]=this.databaseInfo.appId,t["Content-Type"]="text/plain",e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){var n=fc[t];return this.Di+"/v1/"+e+":"+n},t}());function yc(){return"undefined"!=typeof window?window:null}function vc(){return"undefined"!=typeof document?document:null}function mc(t){return new us(t,!0)}var gc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&br("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,(function(){return e.Qi=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),bc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new gc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===yr.RESOURCE_EXHAUSTED?(wr(e.toString()),wr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===yr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then((function(e){t.Yi===n&&t.lr(e)}),(function(n){e((function(){var e=new vr(yr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)}))}))},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){n((function(){return e.state=2,e.listener.Ii()}))})),this.stream.Ri((function(t){n((function(){return e.dr(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return(0,dr.mG)(t,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.dr=function(t){return br("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget((function(){return e.Yi===t?n():(br("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},t}(),wc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return(0,dr.ZT)(e,t),e.prototype.wr=function(t){return this.Hi.$i("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){e.targetChange;var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:_r()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Er(void 0===e||"string"==typeof e),Br.fromBase64String(e||"")):(Er(void 0===e||e instanceof Uint8Array),Br.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?yr.UNKNOWN:Lo(t.code);return new vr(e,t.message||"")}(a);n=new es(r,i,o,s||null)}else if("documentChange"in e){e.documentChange,(r=e.documentChange).document,r.document.name,r.document.updateTime,i=vs(t,r.document.name),o=fs(r.document.updateTime);var a=new fi({mapValue:{fields:r.document.fields}}),u=(s=pi.newFoundDocument(i,o,a),r.targetIds||[]),c=r.removedTargetIds||[];n=new $o(u,c,s.key,s)}else if("documentDelete"in e)e.documentDelete,(r=e.documentDelete).document,i=vs(t,r.document),o=r.readTime?fs(r.readTime):xr.min(),a=pi.newNoDocument(i,o),s=r.removedTargetIds||[],n=new $o([],s,a.key,a);else if("documentRemove"in e)e.documentRemove,(r=e.documentRemove).document,i=vs(t,r.document),o=r.removedTargetIds||[],n=new $o([],o,i,null);else{if(!("filter"in e))return _r();e.filter;var h=e.filter;h.targetId,r=h.count||0,i=new Oo(r),o=h.targetId,n=new ts(o,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return xr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?xr.min():e.readTime?fs(e.readTime):xr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=bs(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=bi(r)?{documents:Ss(t,r)}:{query:As(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=hs(t,e.resumeToken):e.snapshotVersion.compareTo(xr.min())>0&&(n.readTime=cs(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _r()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.R,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=bs(this.R),e.removeTarget=t,this.cr(e)},e}(bc),Tc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return(0,dr.ZT)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.$i("Write",t)},e.prototype.onMessage=function(t){if(Er(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Er(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?fs(t.updateTime):fs(e);return n.isEqual(xr.min())&&(n=fs(e)),new yo(n,t.transformResults||[])}(t,e)}))):[]}(t.writeResults,t.commitTime),n=fs(t.commitTime);return this.listener.Tr(n,e)}return Er(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=bs(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return _s(e.R,t)}))};this.cr(n)},e}(bc),Ic=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return(0,dr.ZT)(e,t),e.prototype.br=function(){if(this.Rr)throw new vr(yr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Ni(t,e,n,i)})).catch((function(t){throw t.code===yr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},e.prototype.Oi=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then((function(i){return r.Hi.Oi(t,e,n,i)})).catch((function(t){throw t.code===yr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t}))},e.prototype.terminate=function(){this.Rr=!1},e}((function(){})),_c=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(wr(e),this.Vr=!1):br("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Ec=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(t){n.enqueueAndForget((function(){return(0,dr.mG)(o,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(t){switch(t.label){case 0:return Oc(this)?(br("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return(e=Sr(t)).$r.add(4),[4,Ac(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.$r.delete(4),[4,Sc(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.Br=new _c(n,r)};function Sc(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e,n;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:if(!Oc(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Ac(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e,n;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))}function Dc(t,e){var n=Sr(t);n.Or.has(e.targetId)||(n.Or.set(e.targetId,e),xc(n)?Rc(n):Hc(n).er()&&Cc(n,e))}function Nc(t,e){var n=Sr(t),r=Hc(n);n.Or.delete(e),r.er()&&kc(n,e),0===n.Or.size&&(r.er()?r.ir():Oc(n)&&n.Br.set("Unknown"))}function Cc(t,e){t.qr.U(e.targetId),Hc(t).mr(e)}function kc(t,e){t.qr.U(e),Hc(t).yr(e)}function Rc(t){t.qr=new rs({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.Or.get(e)||null}}),Hc(t).start(),t.Br.Sr()}function xc(t){return Oc(t)&&!Hc(t).tr()&&t.Or.size>0}function Oc(t){return 0===Sr(t).$r.size}function Pc(t){t.qr=void 0}function Lc(t){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){return t.Or.forEach((function(e,n){Cc(t,e)})),[2]}))}))}function Mc(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(n){return Pc(t),xc(t)?(t.Br.Nr(e),Rc(t)):t.Br.set("Unknown"),[2]}))}))}function Fc(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r,i,o;return(0,dr.Jh)(this,(function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof es&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i,o;return(0,dr.Jh)(this,(function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?(o=i[r],t.Or.has(o)?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]):[3,5];case 2:s.sent(),t.Or.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),br("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,Vc(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof $o?t.qr.X(e):e instanceof ts?t.qr.rt(e):t.qr.et(e),n.isEqual(xr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Ru(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.Or.get(r);i&&t.Or.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((function(e){var n=t.Or.get(e);if(n){t.Or.set(e,n.withResumeToken(Br.EMPTY_BYTE_STRING,n.snapshotVersion)),kc(t,e);var r=new _a(n.target,e,1,n.sequenceNumber);Cc(t,r)}})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return br("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Vc(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function Vc(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r=this;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:if(!pa(e))throw e;return t.$r.add(1),[4,Ac(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Ru(t.localStore)}),t.asyncQueue.enqueueRetryable((function(){return(0,dr.mG)(r,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return br("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.$r.delete(1),[4,Sc(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function Uc(t,e){return e().catch((function(n){return Vc(t,n,e)}))}function qc(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e,n,r,i,o;return(0,dr.Jh)(this,(function(s){switch(s.label){case 0:e=Sr(t),n=Wc(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return Oc(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,Pu(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=Wc(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,Vc(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return Bc(e)&&Gc(e),[2]}}))}))}function Bc(t){return Oc(t)&&!Wc(t).tr()&&t.kr.length>0}function Gc(t){Wc(t).start()}function jc(t){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){return Wc(t).Ar(),[2]}))}))}function Kc(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e,n,r,i;return(0,dr.Jh)(this,(function(o){for(e=Wc(t),n=0,r=t.kr;n<r.length;n++)i=r[n],e.Er(i.mutations);return[2]}))}))}function zc(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r,i;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Ia.from(r,e,n),[4,Uc(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,qc(t)];case 2:return o.sent(),[2]}}))}))}function Jc(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return e&&Wc(t).pr?[4,function(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:return Po(r=e.code)&&r!==yr.ABORTED?(n=t.kr.shift(),Wc(t).sr(),[4,Uc(t,(function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)}))]):[3,3];case 1:return i.sent(),[4,qc(t)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return Bc(t)&&Gc(t),[2]}}))}))}function Qc(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:return n=Sr(t),e?(n.$r.delete(2),[4,Sc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.$r.add(2),[4,Ac(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function Hc(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Sr(t);return r.br(),new wc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:Lc.bind(null,t),Ri:Mc.bind(null,t),_r:Fc.bind(null,t)}),t.Mr.push((function(n){return(0,dr.mG)(e,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return n?(t.Ur.sr(),xc(t)?Rc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),Pc(t),e.label=3;case 3:return[2]}}))}))}))),t.Ur}function Wc(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=Sr(t);return r.br(),new Tc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:jc.bind(null,t),Ri:Jc.bind(null,t),Ir:Kc.bind(null,t),Tr:zc.bind(null,t)}),t.Mr.push((function(n){return(0,dr.mG)(e,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,qc(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(br("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}}))}))}))),t.Qr}var Yc=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ua,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(t){}))}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout((function(){return e.handleDelayElapsed()}),t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new vr(yr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then((function(e){return t.deferred.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Xc(t,e){if(wr("AsyncQueue",e+": "+t),pa(t))return new vr(yr.UNAVAILABLE,e+": "+t);throw t}var Zc=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Zr.comparator(e.key,n.key)}:function(t,e){return Zr.comparator(t.key,e.key)},this.keyedMap=Ko(),this.sortedSet=new Mo(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),$c=function(){function t(){this.Kr=new Mo(Zr.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):_r():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal((function(e,n){t.push(n)})),t},t}(),th=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,Zc.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Ji(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),eh=function(){this.Wr=void 0,this.listeners=[]},nh=function(){this.queries=new cu((function(t){return Qi(t)}),Ji),this.onlineState="Unknown",this.Gr=new Set};function rh(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return(0,dr.Jh)(this,(function(c){switch(c.label){case 0:if(n=Sr(t),r=e.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new eh),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=Xc(a,"Initialization of query '"+Hi(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&ah(n),[2]}}))}))}function ih(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i,o,s;return(0,dr.Jh)(this,(function(a){return n=Sr(t),r=e.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function oh(t,e){for(var n=Sr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&ah(n)}function sh(t,e,n){var r=Sr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function ah(t){t.Gr.forEach((function(t){t.next()}))}var uh=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new th(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.so&&n||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var e=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=th.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),ch=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),hh=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return vs(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Is(this.R,t.document,!1):pi.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return fs(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=lh(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new hh(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||Ho()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return(0,dr.mG)(this,void 0,void 0,(function(){var t,e,n,r,i;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return[4,Bu(this.localStore,new hh(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?(i=r[n],[4,Gu(this.localStore,i,e.get(i.name))]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new _u(Object.assign({},this.progress),t))]}}))}))}}();function lh(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}var fh=function(t){this.key=t},dh=function(t){this.key=t},ph=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=Ho(),this.mutatedKeys=Ho(),this.lo=Yi(t),this.fo=new Zc(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new $c,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=Vi(this.query)&&i.size===this.query.limit?i.last():null,c=Ui(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((function(t,e){var h=i.get(t),l=Wi(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Vi(this.query)||Ui(this.query))for(;s.size>this.query.limit;){var h=Vi(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _r()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)})),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new th(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new $c,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach((function(t){return e.uo=e.uo.add(t)})),t.modifiedDocuments.forEach((function(t){})),t.removedDocuments.forEach((function(t){return e.uo=e.uo.delete(t)})),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=Ho(),this.fo.forEach((function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))}));var n=[];return e.forEach((function(e){t.ho.has(e)||n.push(new dh(e))})),this.ho.forEach((function(t){e.has(t)||n.push(new fh(t))})),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=Ho();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return th.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),yh=function(t,e,n){this.query=t,this.targetId=e,this.view=n},vh=function(t){this.key=t,this.bo=!1},mh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new cu((function(t){return Qi(t)}),Ji),this.Vo=new Map,this.So=new Set,this.Do=new Mo(Zr.comparator),this.Co=new Map,this.No=new Ku,this.xo={},this.Fo=new Map,this.ko=Xa.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.Oo},enumerable:!1,configurable:!0}),t}();function gh(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return(0,dr.Jh)(this,(function(u){switch(u.label){case 0:return n=Qh(t),(o=n.Po.get(e))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,Lu(n.localStore,Ki(e))];case 2:return s=u.sent(),a=n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.targetId,[4,bh(n,e,r,"current"===a)];case 3:i=u.sent(),n.isPrimaryClient&&Dc(n.remoteStore,s),u.label=4;case 4:return[2,i]}}))}))}function bh(t,e,n,r){return(0,dr.mG)(this,void 0,void 0,(function(){var i,o,s,a,u,c;return(0,dr.Jh)(this,(function(h){switch(h.label){case 0:return t.$o=function(e,n,r){return function(t,e,n,r){return(0,dr.mG)(this,void 0,void 0,(function(){var i,o,s;return(0,dr.Jh)(this,(function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,Fu(t.localStore,e.query,!1).then((function(t){var n=t.documents;return e.view._o(n,i)}))]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(xh(t,e.targetId,s.To),s.snapshot)]}}))}))}(t,e,n,r)},[4,Fu(t.localStore,e,!0)];case 1:return i=h.sent(),o=new ph(e,i.Bn),s=o._o(i.documents),a=Zo.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),xh(t,n,u.To),c=new yh(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}}))}))}function wh(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return n=Sr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(t){return!Ji(t,e)}))),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,Mu(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Nc(n.remoteStore,r.targetId),kh(n,r.targetId)})).catch(nu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return kh(n,r.targetId),[4,Mu(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function Th(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r,i,o,s;return(0,dr.Jh)(this,(function(a){switch(a.label){case 0:r=Hh(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Sr(t),i=Rr.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Ho());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(t){return r.Mn.pn(t,o).next((function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=To(c,n.get(c.key));null!=h&&s.push(new So(c.key,h,di(h.toProto().mapValue),vo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)}))})).then((function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}}))}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new Mo(Nr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,Lh(r,i.changes)];case 3:return a.sent(),[4,qc(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Xc(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function Ih(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:n=Sr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,xu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach((function(t,e){var r=n.Co.get(e);r&&(Er(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Er(r.bo):t.removedDocuments.size>0&&(Er(r.bo),r.bo=!1))})),[4,Lh(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,nu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function _h(t,e,n){var r=Sr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach((function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)})),function(t,e){var n=Sr(t);n.onlineState=e;var r=!1;n.queries.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)})),r&&ah(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Eh(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r,i,o,s,a,u;return(0,dr.Jh)(this,(function(c){switch(c.label){case 0:return(r=Sr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new Mo(Zr.comparator)).insert(o,pi.newNoDocument(o,xr.min())),a=Ho().add(o),u=new Xo(xr.min(),new Map,new Uo(Nr),s,a),[4,Ih(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),Ph(r),[3,4];case 2:return[4,Mu(r.localStore,e,!1).then((function(){return kh(r,e,n)})).catch(nu)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))}function Sh(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:n=Sr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,ku(n.localStore,e)];case 2:return i=o.sent(),Ch(n,r,null),Nh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,Lh(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,nu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Ah(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r,i;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:r=Sr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Sr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(t){var r;return n._n.lookupMutationBatch(t,e).next((function(e){return Er(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)})).next((function(){return n._n.performConsistencyCheck(t)})).next((function(){return n.Mn.pn(t,r)}))}))}(r.localStore,e)];case 2:return i=o.sent(),Ch(r,e,n),Nh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,Lh(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,nu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Dh(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i,o,s;return(0,dr.Jh)(this,(function(a){switch(a.label){case 0:Oc((n=Sr(t)).remoteStore)||br("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Sr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(t){return e._n.getHighestUnacknowledgedBatchId(t)}))}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=Xc(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}}))}))}function Nh(t,e){(t.Fo.get(e)||[]).forEach((function(t){t.resolve()})),t.Fo.delete(e)}function Ch(t,e,n){var r=Sr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function kh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach((function(e){t.No.containsKey(e)||Rh(t,e)}))}function Rh(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Nc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),Ph(t))}function xh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof fh?(t.No.addReference(o.key,e),Oh(t,o)):o instanceof dh?(br("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||Rh(t,o.key)):_r()}}function Oh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(br("SyncEngine","New document in limbo: "+n),t.So.add(r),Ph(t))}function Ph(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Zr(Fr.fromString(e)),r=t.ko.next();t.Co.set(r,new vh(n)),t.Do=t.Do.insert(n,r),Dc(t.remoteStore,new _a(Ki(Fi(n.path)),r,2,pr.o))}}function Lh(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r,i,o,s;return(0,dr.Jh)(this,(function(a){switch(a.label){case 0:return r=Sr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(t,a){s.push(r.$o(a,e,n).then((function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Su.Pn(a.targetId,t);o.push(e)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,h;return(0,dr.Jh)(this,(function(l){switch(l.label){case 0:n=Sr(t),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(t){return ca.forEach(e,(function(e){return ca.forEach(e.bn,(function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)})).next((function(){return ca.forEach(e.vn,(function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)}))}))}))}))];case 2:return l.sent(),[3,4];case 3:if(!pa(r=l.sent()))throw r;return br("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)s=o[i],a=s.targetId,s.fromCache||(u=n.Fn.get(a),c=u.snapshotVersion,h=u.withLastLimboFreeSnapshotVersion(c),n.Fn=n.Fn.insert(a,h));return[2]}}))}))}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function Mh(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:return(n=Sr(t)).currentUser.isEqual(e)?[3,3]:(br("SyncEngine","User change. New user:",e.toKey()),[4,Cu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach((function(t){t.forEach((function(t){t.reject(new vr(yr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,Lh(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function Fh(t,e){var n=Sr(t),r=n.Co.get(e);if(r&&r.bo)return Ho().add(r.key);var i=Ho(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function Vh(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return[4,Fu((n=Sr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&xh(n,e.targetId,i.To),i)]}}))}))}function Uh(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){return[2,Uu((e=Sr(t)).localStore).then((function(t){return Lh(e,t)}))]}))}))}function qh(t,e,n,r){return(0,dr.mG)(this,void 0,void 0,(function(){var i,o;return(0,dr.Jh)(this,(function(s){switch(s.label){case 0:return[4,function(t,e){var n=Sr(t),r=Sr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(t){return r.jt(t,e).next((function(e){return e?n.Mn.pn(t,e):ca.resolve(null)}))}))}((i=Sr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,qc(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Ch(i,e,r||null),Nh(i,e),function(t,e){Sr(Sr(t)._n).Gt(e)}(i.localStore,e)):_r(),s.label=4;case 4:return[4,Lh(i,o)];case 5:return s.sent(),[3,7];case 6:br("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}}))}))}function Bh(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c;return(0,dr.Jh)(this,(function(h){switch(h.label){case 0:return Qh(n=Sr(t)),Hh(n),!0!==e||!0===n.Oo?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Gh(n,r.toArray())]);case 1:return i=h.sent(),n.Oo=!0,[4,Qc(n.remoteStore,!0)];case 2:for(h.sent(),o=0,s=i;o<s.length;o++)a=s[o],Dc(n.remoteStore,a);return[3,7];case 3:return!1!==e||!1===n.Oo?[3,7]:(u=[],c=Promise.resolve(),n.Vo.forEach((function(t,e){n.sharedClientState.isLocalQueryTarget(e)?u.push(e):c=c.then((function(){return kh(n,e),Mu(n.localStore,e,!0)})),Nc(n.remoteStore,e)})),[4,c]);case 4:return h.sent(),[4,Gh(n,u)];case 5:return h.sent(),function(t){var e=Sr(t);e.Co.forEach((function(t,n){Nc(e.remoteStore,n)})),e.No.ts(),e.Co=new Map,e.Do=new Mo(Zr.comparator)}(n),n.Oo=!1,[4,Qc(n.remoteStore,!1)];case 6:h.sent(),h.label=7;case 7:return[2]}}))}))}function Gh(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c,h,l,f,d,p,y;return(0,dr.Jh)(this,(function(v){switch(v.label){case 0:n=Sr(t),r=[],i=[],o=0,s=e,v.label=1;case 1:return o<s.length?(a=s[o],u=void 0,(c=n.Vo.get(a))&&0!==c.length?[4,Lu(n.localStore,Ki(c[0]))]:[3,7]):[3,13];case 2:u=v.sent(),h=0,l=c,v.label=3;case 3:return h<l.length?(f=l[h],d=n.Po.get(f),[4,Vh(n,d)]):[3,6];case 4:(p=v.sent()).snapshot&&i.push(p.snapshot),v.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,Vu(n.localStore,a)];case 8:return y=v.sent(),[4,Lu(n.localStore,y)];case 9:return u=v.sent(),[4,bh(n,jh(y),a,!1)];case 10:v.sent(),v.label=11;case 11:r.push(u),v.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}}))}))}function jh(t){return Mi(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Kh(t){var e=Sr(t);return Sr(Sr(e.localStore).persistence).fn()}function zh(t,e,n,r){return(0,dr.mG)(this,void 0,void 0,(function(){var i,o,s;return(0,dr.Jh)(this,(function(a){switch(a.label){case 0:return(i=Sr(t)).Oo?(br("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,Uu(i.localStore)];case 3:return o=a.sent(),s=Xo.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,Lh(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,Mu(i.localStore,e,!0)];case 6:return a.sent(),kh(i,e,r),[3,8];case 7:_r(),a.label=8;case 8:return[2]}}))}))}function Jh(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r,i,o,s,a,u,c,h,l,f;return(0,dr.Jh)(this,(function(d){switch(d.label){case 0:if(!(r=Qh(t)).Oo)return[3,10];i=0,o=e,d.label=1;case 1:return i<o.length?(s=o[i],r.Vo.has(s)?(br("SyncEngine","Adding an already active target "+s),[3,5]):[4,Vu(r.localStore,s)]):[3,6];case 2:return a=d.sent(),[4,Lu(r.localStore,a)];case 3:return u=d.sent(),[4,bh(r,jh(a),u.targetId,!1)];case 4:d.sent(),Dc(r.remoteStore,u),d.label=5;case 5:return i++,[3,1];case 6:c=function(t){return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,Mu(r.localStore,t,!1).then((function(){Nc(r.remoteStore,t),kh(r,t)})).catch(nu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=0,l=n,d.label=7;case 7:return h<l.length?(f=l[h],[5,c(f)]):[3,10];case 8:d.sent(),d.label=9;case 9:return h++,[3,7];case 10:return[2]}}))}))}function Qh(t){var e=Sr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ih.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Fh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Eh.bind(null,e),e.vo._r=oh.bind(null,e.eventManager),e.vo.Mo=sh.bind(null,e.eventManager),e}function Hh(t){var e=Sr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Sh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Ah.bind(null,e),e}var Wh=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return this.R=mc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}}))}))},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Nu(this.persistence,new Au,t.initialUser,this.R)},t.prototype.qo=function(t){return new Yu(Zu.bs,this.R)},t.prototype.Bo=function(t){return new cc},t.prototype.terminate=function(){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},t}(),Yh=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return(0,dr.ZT)(e,t),e.prototype.initialize=function(e){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,qu(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,Hh(this.Ko.syncEngine)];case 4:return n.sent(),[4,qc(this.Ko.remoteStore)];case 5:return n.sent(),[2]}}))}))},e.prototype.Qo=function(t){return Nu(this.persistence,new Au,t.initialUser,this.R)},e.prototype.Uo=function(t){var e=this.persistence.referenceDelegate.garbageCollector;return new ou(e,t.asyncQueue)},e.prototype.qo=function(t){var e=Iu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ja.withCacheSize(this.cacheSizeBytes):ja.DEFAULT;return new bu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,yc(),vc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new cc},e}(Wh),Xh=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return(0,dr.ZT)(e,t),e.prototype.initialize=function(e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r=this;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof uc?(this.sharedClientState.syncEngine={ui:qh.bind(null,n),ai:zh.bind(null,n),hi:Jh.bind(null,n),fn:Kh.bind(null,n),ci:Uh.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He((function(t){return(0,dr.mG)(r,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return[4,Bh(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return i.sent(),[2]}}))}))},e.prototype.Bo=function(t){var e=yc();if(!uc.yt(e))throw new vr(yr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Iu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new uc(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Yh),Zh=function(){function t(){}return t.prototype.initialize=function(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n=this;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return _h(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Mh.bind(null,this.syncEngine),[4,Qc(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.createEventManager=function(t){return new nh},t.prototype.createDatastore=function(t){var e,n=mc(t.databaseInfo.databaseId),r=(e=t.databaseInfo,new pc(e));return function(t,e,n){return new Ic(t,e,n)}(t.credentials,r,n)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return _h(s.syncEngine,t,0)},o=lc.yt()?new lc:new hc,new Ec(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new mh(t,e,n,r,i,o);return s&&(a.Oo=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return e=Sr(t),br("RemoteStore","RemoteStore shutting down."),e.$r.add(5),[4,Ac(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}}))}))}(this.remoteStore)},t}();var $h=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),tl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new ua,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then((function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))}),(function(t){return n.metadata.reject(t)}))}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(t){return[2,this.metadata.promise]}))}))},t.prototype.Lo=function(){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}}))}))},t.prototype.Ho=function(){return(0,dr.mG)(this,void 0,void 0,(function(){var t,e,n,r;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new ch(JSON.parse(r),t.length+n)]}}))}))},t.prototype.Zo=function(){return this.buffer.findIndex((function(t){return t==="{".charCodeAt(0)}))},t.prototype.Jo=function(){return(0,dr.mG)(this,void 0,void 0,(function(){var t,e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}}))}))},t.prototype.Xo=function(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}}))}))},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return(0,dr.mG)(this,void 0,void 0,(function(){var t,e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}}))}))}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e,n=this;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new vr(yr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i,o,s,a;return(0,dr.Jh)(this,(function(u){switch(u.label){case 0:return n=Sr(t),r=bs(n.R)+"/documents",i={documents:e.map((function(t){return ys(n.R,t)}))},[4,n.Oi("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach((function(t){var e=function(t,e){return"found"in e?function(t,e){Er(!!e.found),e.found.name,e.found.updateTime;var n=vs(t,e.found.name),r=fs(e.found.updateTime),i=new fi({mapValue:{fields:e.found.fields}});return pi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Er(!!e.missing),Er(!!e.readTime);var n=vs(t,e.missing),r=fs(e.readTime);return pi.newNoDocument(n,r)}(t,e):_r()}(n.R,t);s.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=s.get(t.toString());Er(!!e),a.push(e)})),a)]}}))}))}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach((function(t){return n.recordVersion(t)})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Ro(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return(0,dr.mG)(this,void 0,void 0,(function(){var t,e=this;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=Zr.fromPath(n);e.mutations.push(new xo(r,e.precondition(r)))})),[4,function(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return n=Sr(t),r=bs(n.R)+"/documents",i={writes:e.map((function(t){return _s(n.R,t)}))},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}}))}))}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}}))}))},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw _r();e=xr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new vr(yr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?vo.updateTime(e):vo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(xr.min()))throw new vr(yr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return vo.updateTime(e)}return vo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),el=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new gc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji((function(){return(0,dr.mG)(t,void 0,void 0,(function(){var t,e,n=this;return(0,dr.Jh)(this,(function(r){return t=new tl(this.datastore),(e=this.sc(t))&&e.then((function(e){n.asyncQueue.enqueueAndForget((function(){return t.commit().then((function(){n.deferred.resolve(e)})).catch((function(t){n.ic(t)}))}))})).catch((function(t){n.ic(t)})),[2]}))}))}))},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!Wr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return e.nc(),Promise.resolve()}))):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Po(e)}return!1},t}(),nl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=$u.UNAUTHENTICATED,this.clientId=Dr.u(),this.credentialListener=function(){},this.receivedInitialUser=new ua,this.credentials.setChangeListener((function(t){br("FirestoreClient","Received user=",t.uid),r.user=t,r.credentialListener(t),r.receivedInitialUser.resolve()}))}return t.prototype.getConfiguration=function(){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},t.prototype.setCredentialChangeListener=function(t){var e=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return e.credentialListener(e.user)}))},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new vr(yr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new ua;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return(0,dr.mG)(t,void 0,void 0,(function(){var t,n;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Xc(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}}))}))})),e.promise},t}();function rl(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r,i=this;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),br("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener((function(n){r.isEqual(n)||(r=n,t.asyncQueue.enqueueRetryable((function(){return(0,dr.mG)(i,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(t){switch(t.label){case 0:return[4,Cu(e.localStore,n)];case 1:return t.sent(),[2]}}))}))})))})),e.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=e,[2]}}))}))}function il(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,ol(t)];case 1:return n=i.sent(),br("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener((function(n){return t.asyncQueue.enqueueRetryable((function(){return function(t,e){return(0,dr.mG)(this,void 0,void 0,(function(){var n,r;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:return(n=Sr(t)).asyncQueue.verifyOperationInProgress(),br("RemoteStore","RemoteStore received new credentials"),r=Oc(n),n.$r.add(3),[4,Ac(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.$r.delete(3),[4,Sc(n)];case 3:return i.sent(),[2]}}))}))}(e.remoteStore,n)}))})),t.onlineComponents=e,[2]}}))}))}function ol(t){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(br("FirestoreClient","Using default OfflineComponentProvider"),[4,rl(t,new Wh)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}}))}))}function sl(t){return(0,dr.mG)(this,void 0,void 0,(function(){return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(br("FirestoreClient","Using default OnlineComponentProvider"),[4,il(t,new Zh)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}}))}))}function al(t){return ol(t).then((function(t){return t.persistence}))}function ul(t){return ol(t).then((function(t){return t.localStore}))}function cl(t){return sl(t).then((function(t){return t.remoteStore}))}function hl(t){return sl(t).then((function(t){return t.syncEngine}))}function ll(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e,n;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:return[4,sl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=gh.bind(null,e.syncEngine),n.onUnlisten=wh.bind(null,e.syncEngine),n)]}}))}))}function fl(t,e,n){var r=this;void 0===n&&(n={});var i=new ua;return t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(r,void 0,void 0,(function(){var r;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new $h({next:function(o){e.enqueueAndForget((function(){return ih(t,s)}));var a=o.docs.has(n);!a&&o.fromCache?i.reject(new vr(yr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new vr(yr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new uh(Fi(n.path),o,{includeMetadataChanges:!0,so:!0});return rh(t,s)},[4,ll(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}function dl(t,e,n){var r=this;void 0===n&&(n={});var i=new ua;return t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(r,void 0,void 0,(function(){var r;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new $h({next:function(n){e.enqueueAndForget((function(){return ih(t,s)})),n.fromCache&&"server"===r.source?i.reject(new vr(yr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new uh(n,o,{includeMetadataChanges:!0,so:!0});return rh(t,s)},[4,ll(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}}))}))})),i.promise}var pl=function(t,e,n,r,i,o,s){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s},yl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),vl=new Map,ml=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},gl=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){this.changeListener=t,t($u.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),bl=function(){function t(t){var e=this;this.oc=null,this.currentUser=$u.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){e.cc++,e.currentUser=e.uc(),e.receivedInitialUser=!0,e.changeListener&&e.changeListener(e.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then((function(t){e.auth=t,e.oc&&e.auth.addAuthTokenListener(e.oc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.cc!==e?(br("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Er("string"==typeof n.accessToken),new ml(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},t.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return Er(null===t||"string"==typeof t),new $u(t)},t}(),wl=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n,this.type="FirstParty",this.user=$u.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},e=this.ac.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),t}(),Tl=function(){function t(t,e,n){this.ac=t,this.hc=e,this.lc=n}return t.prototype.getToken=function(){return Promise.resolve(new wl(this.ac,this.hc,this.lc))},t.prototype.setChangeListener=function(t){t($u.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Il(t,e,n){if(!n)throw new vr(yr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function _l(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new vr(yr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function El(t,e,n,r){if(!0===e&&!0===r)throw new vr(yr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Sl(t){if(!Zr.isDocumentKey(t))throw new vr(yr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Al(t){if(Zr.isDocumentKey(t))throw new vr(yr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Dl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":_r()}function Nl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new vr(yr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Dl(t);throw new vr(yr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Cl(t,e){if(e<=0)throw new vr(yr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var kl=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new vr(yr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new vr(yr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,El("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Rl=function(){function t(t,e){this._persistenceKey="(lite)",this._settings=new kl({}),this._settingsFrozen=!1,t instanceof yl?(this._databaseId=t,this._credentials=new gl):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new vr(yr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new yl(t.options.projectId)}(t),this._credentials=new bl(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new vr(yr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new vr(yr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new kl(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new gl;switch(t.type){case"gapi":var e=t.client;return Er(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Tl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new vr(yr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return this,(t=vl.get(this))&&(br("ComponentProvider","Removing Datastore"),vl.delete(this),t.terminate()),Promise.resolve();var t},t}(),xl=function(){function t(t,e,n){this._converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Pl(this.firestore,this._converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),Ol=function(){function t(t,e,n){this._converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),Pl=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,Fi(r))||this).firestore=e,i._path=r,i.type="collection",i}return(0,dr.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new xl(this.firestore,null,new Zr(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(Ol);function Ll(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];if(t=(0,i.m9)(t),Il("collection","path",e),t instanceof Rl)return Al(n=Fr.fromString.apply(Fr,(0,dr.ev)([e],r))),new Pl(t,null,n);if(!(t instanceof xl||t instanceof Pl))throw new vr(yr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Al(n=Fr.fromString.apply(Fr,(0,dr.ev)([t.path],r)).child(Fr.fromString(e))),new Pl(t.firestore,null,n)}function Ml(t,e){for(var n,r=[],o=2;o<arguments.length;o++)r[o-2]=arguments[o];if(t=(0,i.m9)(t),1===arguments.length&&(e=Dr.u()),Il("doc","path",e),t instanceof Rl)return Sl(n=Fr.fromString.apply(Fr,(0,dr.ev)([e],r))),new xl(t,null,new Zr(n));if(!(t instanceof xl||t instanceof Pl))throw new vr(yr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Sl(n=t._path.child(Fr.fromString.apply(Fr,(0,dr.ev)([e],r)))),new xl(t.firestore,t instanceof Pl?t._converter:null,new Zr(n))}function Fl(t,e){return t=(0,i.m9)(t),e=(0,i.m9)(e),(t instanceof xl||t instanceof Pl)&&(e instanceof xl||e instanceof Pl)&&t.firestore===e.firestore&&t.path===e.path&&t._converter===e._converter}function Vl(t,e){return t=(0,i.m9)(t),e=(0,i.m9)(e),t instanceof Ol&&e instanceof Ol&&t.firestore===e.firestore&&Ji(t._query,e._query)&&t._converter===e._converter}var Ul=function(){function t(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new gc(this,"async_queue_retry"),this.Ec=function(){var e=vc();e&&br("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=vc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},t.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=vc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ec)}},t.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise((function(t){})):this.Ic(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget((function(){return e.dc.push(t),e.Ac()}))},t.prototype.Ac=function(){return(0,dr.mG)(this,void 0,void 0,(function(){var t,e=this;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:if(0===this.dc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return n.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!pa(t=n.sent()))throw t;return br("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji((function(){return e.Ac()})),n.label=5;case 5:return[2]}}))}))},t.prototype.Ic=function(t){var e=this,n=this.fc.then((function(){return e.yc=!0,t().catch((function(t){throw e.mc=t,e.yc=!1,wr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t})).then((function(t){return e.yc=!1,t}))}));return this.fc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Tc(),this.gc.indexOf(t)>-1&&(e=0);var i=Yc.createAndSchedule(this,t,e,n,(function(t){return r.Rc(t)}));return this._c.push(i),i},t.prototype.Tc=function(){this.mc&&_r()},t.prototype.verifyOperationInProgress=function(){},t.prototype.bc=function(){return(0,dr.mG)(this,void 0,void 0,(function(){var t;return(0,dr.Jh)(this,(function(e){switch(e.label){case 0:return[4,t=this.fc];case 1:e.sent(),e.label=2;case 2:if(t!==this.fc)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.vc=function(t){for(var e=0,n=this._c;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Pc=function(t){var e=this;return this.bc().then((function(){e._c.sort((function(t,e){return t.targetTimeMs-e.targetTimeMs}));for(var n=0,r=e._c;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.bc()}))},t.prototype.Vc=function(t){this.gc.push(t)},t.prototype.Rc=function(t){var e=this._c.indexOf(t);this._c.splice(e,1)},t}();function ql(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new ua,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var Bl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._queue=new Ul,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return(0,dr.ZT)(e,t),e.prototype._terminate=function(){return this._firestoreClient||jl(this),this._firestoreClient.terminate()},e}(Rl);function Gl(t){return t._firestoreClient||jl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function jl(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new pl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new nl(t._credentials,t._queue,r)}function Kl(t,e,n){var r=this,i=new ua;return t.asyncQueue.enqueue((function(){return(0,dr.mG)(r,void 0,void 0,(function(){var r;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,rl(t,n)];case 1:return o.sent(),[4,il(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===yr.FAILED_PRECONDITION||t.code===yr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function zl(t){if(t._initialized||t._terminated)throw new vr(yr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Jl=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new vr(yr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ur(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),Ql=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(Br.fromBase64String(e))}catch(e){throw new vr(yr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(Br.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),Hl=function(t){this._methodName=t},Wl=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new vr(yr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new vr(yr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Nr(this._lat,t._lat)||Nr(this._long,t._long)},t}(),Yl=/^__.*__$/,Xl=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new So(t,this.data,this.fieldMask,e,this.fieldTransforms):new Eo(t,this.data,e,this.fieldTransforms)},t}(),Zl=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new So(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function $l(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _r()}}var tf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),t.prototype.Cc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.Nc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Fc(t),r},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Cc({path:n,xc:!1});return r.Sc(),r},t.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},t.prototype.$c=function(t){return Tf(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find((function(e){return t.isPrefixOf(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.isPrefixOf(e.field)}))},t.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},t.prototype.Fc=function(t){if(0===t.length)throw this.$c("Document fields must not be empty");if($l(this.Dc)&&Yl.test(t))throw this.$c('Document fields cannot begin and end with "__"')},t}(),ef=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||mc(t)}return t.prototype.Bc=function(t,e,n,r){return void 0===r&&(r=!1),new tf({Dc:t,methodName:e,Lc:n,path:Ur.emptyPath(),xc:!1,Mc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function nf(t){var e=t._freezeSettings(),n=mc(t._databaseId);return new ef(t._databaseId,!!e.ignoreUndefinedProperties,n)}function rf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Bc(o.merge||o.mergeFields?2:0,e,n,i);mf("Data must be an object, but it was:",s,r);var a,u,c=yf(r,s);if(o.merge)a=new qr(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=gf(e,f[l],n);if(!s.contains(d))throw new vr(yr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");If(h,d)||h.push(d)}a=new qr(h),u=s.fieldTransforms.filter((function(t){return a.covers(t.field)}))}else a=null,u=s.fieldTransforms;return new Xl(new fi(c),a,u)}var of=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,dr.ZT)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Dc)throw 1===t.Dc?t.$c(this._methodName+"() can only appear at the top level of your update data"):t.$c(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(Hl);function sf(t,e,n){return new tf({Dc:3,Lc:e.settings.Lc,methodName:t._methodName,xc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var af=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,dr.ZT)(e,t),e.prototype._toFieldTransform=function(t){return new po(t.path,new oo)},e.prototype.isEqual=function(t){return t instanceof e},e}(Hl),uf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return(0,dr.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=sf(this,t,!0),n=this.qc.map((function(t){return pf(t,e)})),r=new so(n);return new po(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Hl),cf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).qc=n,r}return(0,dr.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=sf(this,t,!0),n=this.qc.map((function(t){return pf(t,e)})),r=new uo(n);return new po(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(Hl),hf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return(0,dr.ZT)(e,t),e.prototype._toFieldTransform=function(t){var e=new ho(t.R,to(t.R,this.Uc));return new po(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(Hl);function lf(t,e,n,r){var o=t.Bc(1,e,n);mf("Data must be an object, but it was:",o,r);var s=[],a=fi.empty();Pr(r,(function(t,r){var u=wf(e,t,n);r=(0,i.m9)(r);var c=o.kc(u);if(r instanceof of)s.push(u);else{var h=pf(r,c);null!=h&&(s.push(u),a.set(u,h))}}));var u=new qr(s);return new Zl(a,u,o.fieldTransforms)}function ff(t,e,n,r,o,s){var a=t.Bc(1,e,n),u=[gf(e,r,n)],c=[o];if(s.length%2!=0)throw new vr(yr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<s.length;h+=2)u.push(gf(e,s[h])),c.push(s[h+1]);for(var l=[],f=fi.empty(),d=u.length-1;d>=0;--d)if(!If(l,u[d])){var p=u[d],y=c[d];y=(0,i.m9)(y);var v=a.kc(p);if(y instanceof of)l.push(p);else{var m=pf(y,v);null!=m&&(l.push(p),f.set(p,m))}}var g=new qr(l);return new Zl(f,g,a.fieldTransforms)}function df(t,e,n,r){return void 0===r&&(r=!1),pf(n,t.Bc(r?4:3,e))}function pf(t,e){if(vf(t=(0,i.m9)(t)))return mf("Unsupported field value:",e,t),yf(t,e);if(t instanceof Hl)return function(t,e){if(!$l(e.Dc))throw e.$c(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.$c(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xc&&4!==e.Dc)throw e.$c("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=pf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,i.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return to(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Rr.fromDate(t);return{timestampValue:cs(e.R,n)}}if(t instanceof Rr)return n=new Rr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:cs(e.R,n)};if(t instanceof Wl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ql)return{bytesValue:hs(e.R,t._byteString)};if(t instanceof xl){n=e.databaseId;var r=t.firestore._databaseId;if(!r.isEqual(n))throw e.$c("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:ds(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.$c("Unsupported field value: "+Dl(t))}(t,e)}function yf(t,e){var n={};return Lr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Pr(t,(function(t,r){var i=pf(r,e.Nc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function vf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Rr||t instanceof Wl||t instanceof Ql||t instanceof xl||t instanceof Hl)}function mf(t,e,n){if(!vf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Dl(n);throw"an object"===r?e.$c(t+" a custom object"):e.$c(t+" "+r)}}function gf(t,e,n){if((e=(0,i.m9)(e))instanceof Jl)return e._internalPath;if("string"==typeof e)return wf(t,e);throw Tf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var bf=new RegExp("[~\\*/\\[\\]]");function wf(t,e,n){if(e.search(bf)>=0)throw Tf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(Jl.bind.apply(Jl,(0,dr.ev)([void 0],e.split(".")))))._internalPath}catch(I){throw Tf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Tf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new vr(yr.INVALID_ARGUMENT,(a+=". ")+t+u)}function If(t,e){return t.some((function(t){return t.isEqual(e)}))}var _f=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new xl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Ef(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Sf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Ef=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,dr.ZT)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(_f);function Sf(t,e){return"string"==typeof e?wf(t,e):e instanceof Jl?e._internalPath:e._delegate._internalPath}var Af=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Df=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return(0,dr.ZT)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Nf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.toProto(),t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Sf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(_f),Nf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,dr.ZT)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Df),Cf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Af(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach((function(r){t.call(e,new Nf(n._firestore,n._userDataWriter,r.key,r,new Af(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query._converter))}))},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new vr(yr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map((function(e){var r=new Nf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Af(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter);return e.doc,{type:"added",doc:r,oldIndex:-1,newIndex:n++}}))}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var n=new Nf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Af(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query._converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:kf(e.type),doc:n,oldIndex:i,newIndex:o}}))}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function kf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _r()}}function Rf(t,e){return t instanceof Df&&e instanceof Df?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Cf&&e instanceof Cf&&t._firestore===e._firestore&&Vl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function xf(t){if(Ui(t)&&0===t.explicitOrderBy.length)throw new vr(yr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Of=function(){};function Pf(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var Lf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qc=e,i.Kc=n,i.jc=r,i.type="where",i}return(0,dr.ZT)(e,t),e.prototype._apply=function(t){var e=nf(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new vr(yr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Gf(s,o);for(var u=[],c=0,h=s;c<h.length;c++){var l=h[c];u.push(Bf(r,t,l))}a={arrayValue:{values:u}}}else a=Bf(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Gf(s,o),a=df(n,"where",s,"in"===o||"not-in"===o);var f=wi.create(i,o,a);return function(t,e){if(e.g()){var n=Bi(t);if(null!==n&&!n.isEqual(e.field))throw new vr(yr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=qi(t);null!==r&&jf(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw i===e.op?new vr(yr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new vr(yr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,f),f}(t._query,0,e,t.firestore._databaseId,this.Qc,this.Kc,this.jc);return new Ol(t.firestore,t._converter,function(t,e){var n=t.filters.concat([e]);return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(Of),Mf=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Qc=e,r.Wc=n,r.type="orderBy",r}return(0,dr.ZT)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new vr(yr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new vr(yr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ri(e,n);return function(t,e){if(null===qi(t)){var n=Bi(t);null!==n&&jf(t,n,e.field)}}(t,r),r}(t._query,this.Qc,this.Wc);return new Ol(t.firestore,t._converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new Li(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(Of),Ff=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Gc=n,i.zc=r,i}return(0,dr.ZT)(e,t),e.prototype._apply=function(t){return new Ol(t.firestore,t._converter,zi(t._query,this.Gc,this.zc))},e}(Of),Vf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,dr.ZT)(e,t),e.prototype._apply=function(t){var e=qf(t,this.type,this.Hc,this.Jc);return new Ol(t.firestore,t._converter,function(t,e){return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(Of),Uf=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return(0,dr.ZT)(e,t),e.prototype._apply=function(t){var e=qf(t,this.type,this.Hc,this.Jc);return new Ol(t.firestore,t._converter,function(t,e){return new Li(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(Of);function qf(t,e,n,r){if(n[0]=(0,i.m9)(n[0]),n[0]instanceof _f)return function(t,e,n,r,i){if(!r)throw new vr(yr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=ji(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(si(e,r.key));else{var c=r.data.field(u.field);if(Jr(c))throw new vr(yr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new vr(yr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Ci(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var o=nf(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new vr(yr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new vr(yr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Gi(t)&&-1!==c.indexOf("/"))throw new vr(yr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(Fr.fromString(c));if(!Zr.isDocumentKey(h))throw new vr(yr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new Zr(h);a.push(si(e,l))}else{var f=df(n,r,c);a.push(f)}}return new Ci(a,o)}(t._query,t.firestore._databaseId,o,e,n,r)}function Bf(t,e,n){if("string"==typeof(n=(0,i.m9)(n))){if(""===n)throw new vr(yr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Gi(e)&&-1!==n.indexOf("/"))throw new vr(yr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(Fr.fromString(n));if(!Zr.isDocumentKey(r))throw new vr(yr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return si(t,new Zr(r))}if(n instanceof xl)return si(t,n._key);throw new vr(yr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Dl(n)+".")}function Gf(t,e){if(!Array.isArray(t)||0===t.length)throw new vr(yr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new vr(yr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function jf(t,e,n){if(!n.isEqual(e))throw new vr(yr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Kf=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),$r(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Kr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(zr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw _r()}},t.prototype.convertObject=function(t,e){var n=this,r={};return Pr(t.fields||{},(function(t,i){r[t]=n.convertValue(i,e)})),r},t.prototype.convertGeoPoint=function(t){return new Wl(Kr(t.latitude),Kr(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map((function(t){return n.convertValue(t,e)}))},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=Qr(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Hr(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=jr(t);return new Rr(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=Fr.fromString(t);Er(Vs(n));var r=new yl(n.get(1),n.get(3)),i=new Zr(n.popFirst(5));return r.isEqual(e)||wr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function zf(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Jf=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,dr.ZT)(e,t),e.prototype.convertBytes=function(t){return new Ql(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new xl(this.firestore,null,e)},e}(Kf),Qf=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=nf(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=Hf(t,this._firestore),i=zf(r._converter,e,n),o=rf(this._dataReader,"WriteBatch.set",r._key,i,null!==r._converter,n);return this._mutations.push(o.toMutation(r._key,vo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];this._verifyNotCommitted();var s,a=Hf(t,this._firestore);return s="string"==typeof(e=(0,i.m9)(e))||e instanceof Jl?ff(this._dataReader,"WriteBatch.update",a._key,e,n,r):lf(this._dataReader,"WriteBatch.update",a._key,e),this._mutations.push(s.toMutation(a._key,vo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=Hf(t,this._firestore);return this._mutations=this._mutations.concat(new Ro(e._key,vo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new vr(yr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function Hf(t,e){if((t=(0,i.m9)(t)).firestore!==e)throw new vr(yr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var Wf=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,dr.ZT)(e,t),e.prototype.convertBytes=function(t){return new Ql(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new xl(this.firestore,null,e)},e}(Kf);function Yf(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];t=Nl(t,xl);var s=Nl(t.firestore,Bl),a=nf(s);return Zf(s,[("string"==typeof(e=(0,i.m9)(e))||e instanceof Jl?ff(a,"updateDoc",t._key,e,n,r):lf(a,"updateDoc",t._key,e)).toMutation(t._key,vo.exists(!0))])}function Xf(t){for(var e,n,r,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];t=(0,i.m9)(t);var a={includeMetadataChanges:!1},u=0;"object"!=typeof o[u]||ql(o[u])||(a=o[u],u++);var c,h,l,f={includeMetadataChanges:a.includeMetadataChanges};if(ql(o[u])){var d=o[u];o[u]=null===(e=d.next)||void 0===e?void 0:e.bind(d),o[u+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),o[u+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(t instanceof xl)h=Nl(t.firestore,Bl),l=Fi(t._key.path),c={next:function(e){o[u]&&o[u]($f(h,t,e))},error:o[u+1],complete:o[u+2]};else{var p=Nl(t,Ol);h=Nl(p.firestore,Bl),l=p._query;var y=new Wf(h);c={next:function(t){o[u]&&o[u](new Cf(h,y,p,t))},error:o[u+1],complete:o[u+2]},xf(t._query)}return function(t,e,n,r){var i=this,o=new $h(r),s=new uh(e,o,n);return t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(i,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return e=rh,[4,ll(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))})),function(){o.Wo(),t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(i,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return e=ih,[4,ll(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}}))}))}))}}(Gl(h),l,f,c)}function Zf(t,e){return function(t,e){var n=this,r=new ua;return t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(n,void 0,void 0,(function(){var n;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:return n=Th,[4,hl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(Gl(t),e)}function $f(t,e,n){var r=n.docs.get(e._key),i=new Wf(t);return new Df(t,i,e._key,r,new Af(n.hasPendingWrites,n.fromCache),e._converter)}var td=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return(0,dr.ZT)(e,t),e.prototype.get=function(e){var n=this,r=Hf(e,this._firestore),i=new Wf(this._firestore);return t.prototype.get.call(this,e).then((function(t){return new Df(n._firestore,i,r._key,t._document,new Af(!1,!1),r._converter)}))},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=nf(t)}return t.prototype.get=function(t){var e=this,n=Hf(t,this._firestore),r=new Jf(this._firestore);return this._transaction.lookup([n._key]).then((function(t){if(!t||1!==t.length)return _r();var i=t[0];if(i.isFoundDocument())return new _f(e._firestore,r,i.key,i,n._converter);if(i.isNoDocument())return new _f(e._firestore,r,n._key,null,n._converter);throw _r()}))},t.prototype.set=function(t,e,n){var r=Hf(t,this._firestore),i=zf(r._converter,e,n),o=rf(this._dataReader,"Transaction.set",r._key,i,null!==r._converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var s,a=Hf(t,this._firestore);return s="string"==typeof(e=(0,i.m9)(e))||e instanceof Jl?ff(this._dataReader,"Transaction.update",a._key,e,n,r):lf(this._dataReader,"Transaction.update",a._key,e),this._transaction.update(a._key,s),this},t.prototype.delete=function(t){var e=Hf(t,this._firestore);return this._transaction.delete(e._key),this},t}());function ed(){if("undefined"==typeof Uint8Array)throw new vr(yr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function nd(){if("undefined"==typeof atob)throw new vr(yr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var rd=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return nd(),new t(Ql.fromBase64String(e))},t.fromUint8Array=function(e){return ed(),new t(Ql.fromUint8Array(e))},t.prototype.toBase64=function(){return nd(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return ed(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),id=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){zl(t=Nl(t,Bl));var n=Gl(t),r=t._freezeSettings(),i=new Zh;return Kl(n,i,new Yh(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){zl(t=Nl(t,Bl));var e=Gl(t),n=t._freezeSettings(),r=new Zh;return Kl(e,r,new Xh(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new vr(yr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new ua;return t._queue.enqueueAndForgetEvenWhileRestricted((function(){return(0,dr.mG)(e,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return la.yt()?(e=t+"main",[4,la.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(Iu(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}}))}))})),n.promise}(t._delegate)},t}(),od=function(){function t(t,e,n){var r=this;this._delegate=e,this.Yc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof yl||(this.Xc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e){!function(t,e,n){var r=(t=Nl(t,Rl))._getSettings();"firestore.googleapis.com"!==r.host&&r.host!==e&&Tr("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},r),{host:e+":"+n,ssl:!1}))}(this._delegate,t,e)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return(0,dr.mG)(e,void 0,void 0,(function(){var e,n;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:return[4,al(t)];case 1:return e=r.sent(),[4,cl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Sr(t);return e.$r.delete(0),Sc(e)}(n))]}}))}))}))}(Gl(Nl(this._delegate,Bl)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue((function(){return(0,dr.mG)(e,void 0,void 0,(function(){var e,n;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:return[4,al(t)];case 1:return e=r.sent(),[4,cl(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return(0,dr.mG)(this,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return(e=Sr(t)).$r.add(0),[4,Ac(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}}))}))}(n))]}}))}))}))}(Gl(Nl(this._delegate,Bl)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&El("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new ua;return t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(e,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(r){switch(r.label){case 0:return e=Dh,[4,hl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}}))}))})),n.promise}(Gl(Nl(this._delegate,Bl)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new $h(e);return t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(n,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return e=function(t,e){Sr(t).Gr.add(e),e.next()},[4,ll(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))})),function(){r.Wo(),t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(n,void 0,void 0,(function(){var e;return(0,dr.Jh)(this,(function(n){switch(n.label){case 0:return e=function(t,e){Sr(t).Gr.delete(e)},[4,ll(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}}))}))}))}}(Gl(t=Nl(t,Bl)),ql(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Xc)throw new vr(yr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new bd(this,Ll(this._delegate,t))}catch(t){throw ld(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new hd(this,Ml(this._delegate,t))}catch(t){throw ld(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new vd(this,function(t,e){if(t=Nl(t,Rl),Il("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new vr(yr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Ol(t,null,function(t){return new Li(Fr.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw ld(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new ua;return t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(n,void 0,void 0,(function(){var n;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:return[4,function(t){return sl(t).then((function(t){return t.datastore}))}(t)];case 1:return n=i.sent(),new el(t.asyncQueue,n,e,r).run(),[2]}}))}))})),r.promise}(Gl(t),(function(n){return e(new td(t,n))}))}(this._delegate,(function(n){return t(new ad(e,n))}))},t.prototype.batch=function(){var t=this;return Gl(this._delegate),new ud(new Qf(this._delegate,(function(e){return Zf(t._delegate,e)})))},t.prototype.loadBundle=function(t){throw new vr(yr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new vr(yr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),sd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return(0,dr.ZT)(e,t),e.prototype.convertBytes=function(t){return new rd(new Ql(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return hd.Zc(e,this.firestore,null)},e}(Kf);var ad=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new sd(t)}return t.prototype.get=function(t){var e=this,n=wd(t);return this._delegate.get(n).then((function(t){return new pd(e._firestore,new Df(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n._converter))}))},t.prototype.set=function(t,e,n){var r=wd(t);return n?(_l("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=wd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,(0,dr.ev)([s,e,n],i)),this},t.prototype.delete=function(t){var e=wd(t);return this._delegate.delete(e),this},t}(),ud=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=wd(t);return n?(_l("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=wd(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,(0,dr.ev)([s,e,n],i)),this},t.prototype.delete=function(t){var e=wd(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),cd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Nf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new yd(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.tu=function(e,n){var r=t.eu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new sd(e),n),i.set(n,o)),o},t}();cd.eu=new WeakMap;var hd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new sd(t)}return t.nu=function(e,n,r){if(e.length%2!=0)throw new vr(yr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new xl(n._delegate,r,new Zr(e)))},t.Zc=function(e,n,r){return new t(n,new xl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new bd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new bd(this.firestore,Ll(this._delegate,t))}catch(t){throw ld(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=(0,i.m9)(t))instanceof xl&&Fl(this._delegate,t)},t.prototype.set=function(t,e){e=_l("DocumentReference.set",e);try{return function(t,e,n){t=Nl(t,xl);var r=Nl(t.firestore,Bl),i=zf(t._converter,e,n);return Zf(r,[rf(nf(r),"setDoc",t._key,i,null!==t._converter,n).toMutation(t._key,vo.none())])}(this._delegate,t,e)}catch(t){throw ld(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?Yf(this._delegate,t):Yf.apply(void 0,(0,dr.ev)([this._delegate,t,e],n))}catch(t){throw ld(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return Zf(Nl((t=this._delegate).firestore,Bl),[new Ro(t._key,vo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=fd(e),i=dd(e,(function(e){return new pd(t.firestore,new Df(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate._converter))}));return Xf(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Nl(t,xl);var e=Nl(t.firestore,Bl),n=Gl(e),r=new Wf(e);return function(t,e){var n=this,r=new ua;return t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(n,void 0,void 0,(function(){var n;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r,i;return(0,dr.Jh)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Sr(t);return n.persistence.runTransaction("read document","readonly",(function(t){return n.Mn.mn(t,e)}))}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new vr(yr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Xc(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}}))}))},[4,ul(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._key).then((function(n){return new Df(e,r,t._key,n,new Af(null!==n&&n.hasLocalMutations,!0),t._converter)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Nl(t,xl);var e=Nl(t.firestore,Bl);return fl(Gl(e),t._key,{source:"server"}).then((function(n){return $f(e,t,n)}))}(this._delegate):function(t){t=Nl(t,xl);var e=Nl(t.firestore,Bl);return fl(Gl(e),t._key).then((function(n){return $f(e,t,n)}))}(this._delegate)).then((function(t){return new pd(e.firestore,new Df(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate._converter))}))},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(cd.tu(this.firestore,e)):this._delegate.withConverter(null))},t}();function ld(t,e,n){return t.message=t.message.replace(e,n),t}function fd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!ql(r))return r}return{}}function dd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=ql(t[0])?t[0]:ql(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var pd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new hd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Rf(this._delegate,t._delegate)},t}(),yd=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return(0,dr.ZT)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(pd),vd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new sd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,Pf(this._delegate,function(t,e,n){var r=e,i=Sf("where",t);return new Lf(i,r,n)}(e,n,r)))}catch(e){throw ld(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,Pf(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Sf("orderBy",t);return new Mf(r,n)}(e,n)))}catch(e){throw ld(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,Pf(this._delegate,function(t){return Cl("limit",t),new Ff("limit",t,"F")}(e)))}catch(e){throw ld(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,Pf(this._delegate,function(t){return Cl("limitToLast",t),new Ff("limitToLast",t,"L")}(e)))}catch(e){throw ld(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Pf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vf("startAt",t,!0)}.apply(void 0,e)))}catch(e){throw ld(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Pf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Vf("startAfter",t,!1)}.apply(void 0,e)))}catch(e){throw ld(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Pf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Uf("endBefore",t,!0)}.apply(void 0,e)))}catch(e){throw ld(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,Pf(this._delegate,function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Uf("endAt",t,!1)}.apply(void 0,e)))}catch(e){throw ld(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return Vl(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Nl(t,Ol);var e=Nl(t.firestore,Bl),n=Gl(e),r=new Wf(e);return function(t,e){var n=this,r=new ua;return t.asyncQueue.enqueueAndForget((function(){return(0,dr.mG)(n,void 0,void 0,(function(){var n;return(0,dr.Jh)(this,(function(i){switch(i.label){case 0:return n=function(t,e,n){return(0,dr.mG)(this,void 0,void 0,(function(){var r,i,o,s,a;return(0,dr.Jh)(this,(function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,Fu(t,e,!0)];case 1:return a=u.sent(),r=new ph(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=Xc(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}}))}))},[4,ul(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}}))}))})),r.promise}(n,t._query).then((function(n){return new Cf(e,r,t,n)}))}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Nl(t,Ol);var e=Nl(t.firestore,Bl),n=Gl(e),r=new Wf(e);return dl(n,t._query,{source:"server"}).then((function(n){return new Cf(e,r,t,n)}))}(this._delegate):function(t){t=Nl(t,Ol);var e=Nl(t.firestore,Bl),n=Gl(e),r=new Wf(e);return xf(t._query),dl(n,t._query).then((function(n){return new Cf(e,r,t,n)}))}(this._delegate)).then((function(t){return new gd(e.firestore,new Cf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}))},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=fd(e),i=dd(e,(function(e){return new gd(t.firestore,new Cf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))}));return Xf(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,e?this._delegate.withConverter(cd.tu(this.firestore,e)):this._delegate.withConverter(null))},t}(),md=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new yd(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),gd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new vd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(e){return new yd(t._firestore,e)}))},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map((function(t){return new md(e._firestore,t)}))},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach((function(r){t.call(e,new yd(n._firestore,r))}))},t.prototype.isEqual=function(t){return Rf(this._delegate,t._delegate)},t}(),bd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return(0,dr.ZT)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new hd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new hd(this.firestore,void 0===t?Ml(this._delegate):Ml(this._delegate,t))}catch(t){throw ld(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Nl(t.firestore,Bl),r=Ml(t),i=zf(t._converter,e);return Zf(n,[rf(nf(t.firestore),"addDoc",r._key,i,null!==t._converter,{}).toMutation(r._key,vo.exists(!1))]).then((function(){return r}))}(this._delegate,t).then((function(t){return new hd(e.firestore,t)}))},e.prototype.isEqual=function(t){return Fl(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(cd.tu(this.firestore,t)):this._delegate.withConverter(null))},e}(vd);function wd(t){return Nl(t,xl)}var Td=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(Jl.bind.apply(Jl,(0,dr.ev)([void 0],t)))}return t.documentId=function(){return new t(Ur.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=(0,i.m9)(t))instanceof Jl&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Id=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new af("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new of("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new uf("arrayUnion",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new cf("arrayRemove",t)}.apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new hf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}();var _d,Ed=n(826),Sd={Firestore:od,GeoPoint:Wl,Timestamp:Rr,Blob:rd,Transaction:ad,WriteBatch:ud,DocumentReference:hd,DocumentSnapshot:pd,Query:vd,QueryDocumentSnapshot:yd,QuerySnapshot:gd,CollectionReference:bd,FieldPath:Td,FieldValue:Id,setLogLevel:function(t){var e;e=t,mr.setLogLevel(e)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new Ed.wA("firestore",(function(t){return function(t,e){return new od(t,new Bl(t,e),new id)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},Sd)))})(_d=r.Z),_d.registerVersion("@firebase/firestore","2.2.3")}}]);
//# sourceMappingURL=firestore.0e281b83.chunk.js.map